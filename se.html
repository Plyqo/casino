<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–õ–∞–±–∏—Ä–∏–Ω—Ç –®–∞—Ö—Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        body {
            background-color: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            overflow: hidden;
            padding: 0;
            touch-action: none;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        #gameCanvas {
            display: block;
            background-color: #0a0a0a;
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .crosshair {
            position: absolute;
            width: 24px;
            height: 24px;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 100;
            display: none;
        }
        
        .crosshair::before, .crosshair::after {
            content: '';
            position: absolute;
            background: #00ff00;
        }
        
        .crosshair::before {
            width: 2px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .crosshair::after {
            width: 100%;
            height: 2px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            color: white;
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .game-over h2 {
            color: #ff5555;
            font-size: clamp(32px, 8vw, 48px);
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 85, 85, 0.5);
        }
        
        .game-over p {
            font-size: clamp(18px, 5vw, 24px);
            margin-bottom: 30px;
        }
        
        .restart-btn {
            background-color: #ff5555;
            color: white;
            border: none;
            padding: clamp(12px, 3vw, 16px) clamp(30px, 8vw, 40px);
            font-size: clamp(16px, 4vw, 20px);
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            pointer-events: auto;
            min-height: 44px;
            min-width: 120px;
            margin: 10px;
        }
        
        .restart-btn:hover, .restart-btn:active {
            background-color: #ff7777;
            transform: scale(1.05);
        }
        
        .chest-progress {
            position: absolute;
            bottom: clamp(70px, 15vh, 120px);
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: clamp(8px, 2vw, 12px) clamp(15px, 4vw, 20px);
            border-radius: 10px;
            color: white;
            font-size: clamp(12px, 3vw, 16px);
            display: none;
            z-index: 10;
            text-align: center;
            min-width: min(90vw, 300px);
            max-width: 90vw;
            border: 2px solid #8B4513;
            pointer-events: none;
            box-shadow: 0 0 20px rgba(139, 69, 19, 0.3);
            word-wrap: break-word;
        }
        
        .progress-bar {
            width: 100%;
            height: clamp(12px, 3vw, 20px);
            background-color: #333;
            border-radius: 10px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9900, #ffcc00);
            width: 0%;
            transition: width 0.3s;
            border-radius: 10px;
        }
        
        .chest-indicator {
            position: absolute;
            top: clamp(10px, 3vh, 20px);
            left: clamp(10px, 3vw, 20px);
            background-color: rgba(0, 0, 0, 0.9);
            padding: clamp(6px, 2vw, 10px) clamp(10px, 3vw, 20px);
            border-radius: 10px;
            color: white;
            font-size: clamp(12px, 3vw, 16px);
            z-index: 10;
            text-align: center;
            border: 2px solid #8B4513;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(139, 69, 19, 0.3);
        }
        
        .lives-indicator {
            position: absolute;
            top: clamp(10px, 3vh, 20px);
            right: clamp(10px, 3vw, 20px);
            background-color: rgba(0, 0, 0, 0.9);
            padding: clamp(6px, 2vw, 10px) clamp(10px, 3vw, 20px);
            border-radius: 10px;
            color: white;
            font-size: clamp(12px, 3vw, 16px);
            z-index: 10;
            text-align: center;
            border: 2px solid #ff5555;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(255, 85, 85, 0.3);
        }
        
        .score-indicator {
            position: absolute;
            top: clamp(60px, 10vh, 70px);
            left: clamp(10px, 3vw, 20px);
            background-color: rgba(0, 0, 0, 0.9);
            padding: clamp(6px, 2vw, 10px) clamp(10px, 3vw, 20px);
            border-radius: 10px;
            color: white;
            font-size: clamp(12px, 3vw, 16px);
            z-index: 10;
            text-align: center;
            border: 2px solid #4a9de3;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(74, 157, 227, 0.3);
        }
        
        .controls-info {
            position: absolute;
            bottom: clamp(10px, 3vh, 20px);
            left: clamp(10px, 3vw, 20px);
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: clamp(8px, 2vw, 12px);
            border-radius: 10px;
            text-align: left;
            max-width: min(90vw, 300px);
            font-size: clamp(10px, 2.5vw, 12px);
            pointer-events: none;
            display: none;
        }
        
        .controls-info h3 {
            color: #ff9900;
            margin-bottom: 5px;
            font-size: clamp(12px, 3vw, 14px);
        }
        
        .controls-info p {
            margin-bottom: 3px;
            line-height: 1.3;
        }
        
        .respawn-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 15;
            color: white;
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .respawn-screen h3 {
            color: #ff9900;
            font-size: clamp(28px, 7vw, 36px);
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 153, 0, 0.5);
        }
        
        .respawn-screen p {
            font-size: clamp(16px, 4vw, 20px);
            margin-bottom: 10px;
        }
        
        .bat-attack-indicator {
            position: absolute;
            top: clamp(110px, 15vh, 120px);
            right: clamp(10px, 3vw, 20px);
            background-color: rgba(139, 0, 139, 0.9);
            padding: clamp(6px, 2vw, 10px) clamp(10px, 3vw, 20px);
            border-radius: 10px;
            color: white;
            font-size: clamp(11px, 2.5vw, 14px);
            z-index: 10;
            text-align: center;
            border: 2px solid #FF00FF;
            pointer-events: none;
            display: none;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.3);
        }
        
        /* –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ */
        .mobile-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30vh;
            pointer-events: none;
            z-index: 5;
            display: none;
        }
        
        .mobile-joystick {
            position: absolute;
            bottom: clamp(20px, 5vh, 40px);
            left: clamp(20px, 5vw, 40px);
            width: clamp(100px, 25vw, 140px);
            height: clamp(100px, 25vw, 140px);
            pointer-events: auto;
            display: none;
        }
        
        .joystick-base {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .joystick-head {
            position: absolute;
            width: 50%;
            height: 50%;
            background-color: rgba(74, 157, 227, 0.8);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid rgba(255, 255, 255, 0.5);
            transition: transform 0.1s;
        }
        
        .mobile-buttons {
            position: absolute;
            bottom: clamp(20px, 5vh, 40px);
            right: clamp(20px, 5vw, 40px);
            width: clamp(140px, 35vw, 200px);
            height: clamp(100px, 25vw, 140px);
            pointer-events: auto;
            display: none;
            gap: 10px;
        }
        
        .mobile-btn {
            width: clamp(50px, 12vw, 70px);
            height: clamp(50px, 12vw, 70px);
            background-color: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            color: white;
            font-size: clamp(14px, 3vw, 18px);
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            touch-action: manipulation;
            position: absolute;
        }
        
        .mobile-btn:active {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(0.95);
        }
        
        .btn-shoot {
            background-color: rgba(255, 85, 85, 0.8);
            border-color: rgba(255, 255, 255, 0.7);
            bottom: 0;
            right: 0;
        }
        
        .btn-action {
            background-color: rgba(255, 153, 0, 0.8);
            border-color: rgba(255, 255, 255, 0.7);
            bottom: 0;
            left: 0;
        }
        
        .btn-pause {
            position: absolute;
            top: clamp(10px, 3vh, 20px);
            right: clamp(60px, 15vw, 100px);
            width: clamp(40px, 10vw, 50px);
            height: clamp(40px, 10vw, 50px);
            background-color: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            color: white;
            font-size: clamp(16px, 4vw, 20px);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            z-index: 11;
            display: none;
        }
        
        .pause-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 25;
            color: white;
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .pause-menu h2 {
            color: #4a9de3;
            font-size: clamp(32px, 8vw, 48px);
            margin-bottom: 30px;
        }
        
        .pause-btn {
            background-color: #4a9de3;
            color: white;
            border: none;
            padding: clamp(12px, 3vw, 16px) clamp(30px, 8vw, 40px);
            font-size: clamp(16px, 4vw, 20px);
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin: 10px;
            min-height: 44px;
            min-width: 200px;
        }
        
        .pause-btn:hover, .pause-btn:active {
            background-color: #6bb5f0;
            transform: scale(1.05);
        }
        
        .orientation-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .orientation-warning h2 {
            color: #ff9900;
            font-size: clamp(24px, 6vw, 32px);
            margin-bottom: 20px;
        }
        
        .orientation-warning p {
            font-size: clamp(16px, 4vw, 20px);
            margin-bottom: 10px;
            max-width: 90%;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        @media (max-width: 768px) {
            .controls-info {
                display: block;
            }
            
            .crosshair {
                display: block;
            }
        }
        
        @media (max-height: 500px) {
            .chest-indicator,
            .lives-indicator,
            .score-indicator,
            .bat-attack-indicator {
                padding: 4px 8px;
                font-size: 10px;
            }
            
            .chest-progress {
                bottom: 60px;
                padding: 6px 10px;
                font-size: 10px;
            }
        }
        
        @media (orientation: portrait) and (max-width: 768px) {
            .orientation-warning {
                display: flex;
            }
            
            #gameContainer {
                display: none;
            }
        }
        
        @media (orientation: landscape) and (max-height: 500px) {
            .mobile-controls {
                height: 40vh;
            }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="orientation-warning" id="orientationWarning">
        <h2>üì± –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h2>
        <p>–î–ª—è –ª—É—á—à–µ–≥–æ –∏–≥—Ä–æ–≤–æ–≥–æ –æ–ø—ã—Ç–∞ –ø–µ—Ä–µ–≤–µ—Ä–Ω–∏—Ç–µ –≤–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é (–∞–ª—å–±–æ–º–Ω—ã–π —Ä–µ–∂–∏–º).</p>
        <p>–ò–≥—Ä–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∏–≥—Ä—ã –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ.</p>
    </div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div class="hud">
            <div class="crosshair" id="crosshair"></div>
            <div class="chest-indicator" id="chestIndicator">–°—É–Ω–¥—É–∫–æ–≤: 0/3</div>
            <div class="lives-indicator" id="livesIndicator">–ñ–∏–∑–Ω–∏: ‚ù§‚ù§‚ù§</div>
            <div class="score-indicator" id="scoreIndicator">–°—á–µ—Ç: 0</div>
            <div class="bat-attack-indicator" id="batAttackIndicator">–ú—ã—à—å –∞—Ç–∞–∫—É–µ—Ç: 0%</div>
            <div class="chest-progress" id="chestProgress">
                <div id="chestText">–û—Ç–∫—Ä—ã—Ç–∏–µ —Å—É–Ω–¥—É–∫–∞... (–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ E)</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="respawn-screen" id="respawnScreen">
                <h3 class="pulse">–í–û–ó–†–û–ñ–î–ï–ù–ò–ï</h3>
                <p>–û—Å—Ç–∞–ª–æ—Å—å –∂–∏–∑–Ω–µ–π: <span id="remainingLives">2</span></p>
                <p>–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑: <span id="respawnTimer">3</span></p>
            </div>
        </div>
        
        <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
        <div class="mobile-controls" id="mobileControls">
            <div class="mobile-joystick" id="joystick">
                <div class="joystick-base"></div>
                <div class="joystick-head" id="joystickHead"></div>
            </div>
            <div class="mobile-buttons" id="mobileButtons">
                <div class="mobile-btn btn-action" id="btnAction">E</div>
                <div class="mobile-btn btn-shoot" id="btnShoot">‚ö°</div>
            </div>
            <div class="btn-pause" id="btnPause">‚è∏</div>
        </div>
        
        <div class="game-over" id="gameOverScreen">
            <h2 class="fade-in">–ü–û–†–ê–ñ–ï–ù–ò–ï</h2>
            <p>–°—á–µ—Ç: <span id="finalScore">0</span></p>
            <button class="restart-btn" id="restartBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
        
        <div class="pause-menu" id="pauseMenu">
            <h2 class="fade-in">–ü–ê–£–ó–ê</h2>
            <button class="pause-btn" id="resumeBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            <button class="pause-btn" id="restartPauseBtn">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
            <button class="restart-btn" id="quitBtn">–í—ã–π—Ç–∏</button>
        </div>
        
        <div class="controls-info">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
            <p><strong>WASD/–°—Ç–∏–∫</strong> - –¥–≤–∏–∂–µ–Ω–∏–µ</p>
            <p><strong>–õ–ö–ú/–ö–Ω–æ–ø–∫–∞ ‚ö°</strong> - —Å—Ç—Ä–µ–ª—å–±–∞</p>
            <p><strong>E/–ö–Ω–æ–ø–∫–∞ E</strong> - –æ—Ç–∫—Ä—ã—Ç—å —Å—É–Ω–¥—É–∫</p>
            <p><strong>3 –∂–∏–∑–Ω–∏</strong>, –ø–æ—Ç–æ–º –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</p>
            <p><strong>–õ–µ—Ç—É—á–∏–µ –º—ã—à–∏</strong>: —É–±–∏–≤–∞—é—Ç –∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã</p>
        </div>
    </div>

    <script>
        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const crosshair = document.getElementById('crosshair');
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const mobileControls = document.getElementById('mobileControls');
        const joystick = document.getElementById('joystick');
        const joystickHead = document.getElementById('joystickHead');
        const mobileButtons = document.getElementById('mobileButtons');
        const btnAction = document.getElementById('btnAction');
        const btnShoot = document.getElementById('btnShoot');
        const btnPause = document.getElementById('btnPause');
        const pauseMenu = document.getElementById('pauseMenu');
        const resumeBtn = document.getElementById('resumeBtn');
        const restartPauseBtn = document.getElementById('restartPauseBtn');
        const quitBtn = document.getElementById('quitBtn');
        const orientationWarning = document.getElementById('orientationWarning');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–± –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
        function checkOrientation() {
            if (window.innerHeight > window.innerWidth && isMobile) {
                orientationWarning.style.display = 'flex';
                document.getElementById('gameContainer').style.display = 'none';
            } else {
                orientationWarning.style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function initMobileControls() {
            if (isMobile || isTouchDevice) {
                mobileControls.style.display = 'block';
                joystick.style.display = 'block';
                mobileButtons.style.display = 'flex';
                btnPause.style.display = 'flex';
                crosshair.style.display = 'block';
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø—Ä–∏—Ü–µ–ª
                crosshair.style.left = '50%';
                crosshair.style.top = '50%';
                gameState.mouseX = canvas.width / 2;
                gameState.mouseY = canvas.height / 2;
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∑—É–º –∫–∞–º–µ—Ä—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
                camera.zoom = 0.8;
            } else {
                mobileControls.style.display = 'none';
            }
        }
        
        // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä canvas
        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            
            ctx.scale(dpr, dpr);
            
            // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–∞–º–µ—Ä—ã
            camera.width = rect.width;
            camera.height = rect.height;
            
            // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∑—É–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
            const screenSize = Math.min(window.innerWidth, window.innerHeight);
            if (screenSize < 768) {
                camera.zoom = 0.7;
            } else if (screenSize < 1024) {
                camera.zoom = 0.9;
            } else {
                camera.zoom = 1.0;
            }
            
            // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–≥—Ä–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            updateGameSizes();
            
            checkOrientation();
            initMobileControls();
            updateCrosshair();
        }
        
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–≥—Ä–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function updateGameSizes() {
            const screenSize = Math.min(window.innerWidth, window.innerHeight);
            
            // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
            if (screenSize < 768) {
                gameState.TILE_SIZE = 50;
                gameState.PLAYER_SIZE = 20;
                gameState.ENEMY_SIZE = 24;
                gameState.BAT_SIZE = 18;
                gameState.PROJECTILE_SIZE = 6;
            } else {
                gameState.TILE_SIZE = 60;
                gameState.PLAYER_SIZE = 24;
                gameState.ENEMY_SIZE = 28;
                gameState.BAT_SIZE = 20;
                gameState.PROJECTILE_SIZE = 8;
            }
        }
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('orientationchange', function() {
            setTimeout(resizeCanvas, 100);
            setTimeout(checkOrientation, 100);
        });
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã (–±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ updateGameSizes)
        const MAP_WIDTH = 40;
        const MAP_HEIGHT = 30;
        const PLAYER_SPEED = 6;
        const PROJECTILE_SPEED = 12;
        const PLAYER_SHOOT_DELAY = 400;
        const ENEMY_SPEED = 2.5;
        const ENEMY_VISION_RANGE = 400;
        const SKELETON_SPEED = 1.8;
        const SKELETON_SHOOT_RANGE = 450;
        const SKELETON_PROJECTILE_SPEED = 8;
        const BAT_SPEED = 4.5;
        const BAT_VISION_RANGE = 500;
        const BAT_ATTACK_TIME = 120;
        const LASER_LENGTH = 200;
        const PLAYER_LIVES = 3;
        const RESPAWN_TIME = 3;
        
        // –ö–∞–º–µ—Ä–∞
        const camera = {
            x: 0,
            y: 0,
            width: 800,
            height: 600,
            zoom: 1.0,
            followSpeed: 0.2
        };
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        const gameState = {
            TILE_SIZE: 60,
            PLAYER_SIZE: 24,
            ENEMY_SIZE: 28,
            BAT_SIZE: 20,
            PROJECTILE_SIZE: 8,
            
            player: {
                x: 0,
                y: 0,
                startX: 0,
                startY: 0,
                hasKey: false,
                hasSmallKey: false,
                lastShotTime: 0,
                canShoot: true,
                openingChest: null,
                chestProgress: 0,
                lives: PLAYER_LIVES,
                respawning: false,
                respawnTimer: 0,
                invulnerable: false,
                invulnerableTimer: 0
            },
            projectiles: [],
            enemyProjectiles: [],
            enemies: [],
            skeletons: [],
            bats: [],
            map: [],
            spikes: [],
            chests: [],
            key: null,
            smallKey: null,
            exit: null,
            doors: [],
            smallDoors: [],
            score: 0,
            gameOver: false,
            paused: false,
            mouseX: canvas.width / 2,
            mouseY: canvas.height / 2,
            keys: {
                w: false,
                a: false,
                s: false,
                d: false,
                e: false
            },
            touch: {
                joystick: { x: 0, y: 0, active: false },
                shoot: false,
                action: false
            },
            chestsOpened: 0,
            chestsTotal: 3,
            lastUpdateTime: 0,
            crosshairVisible: true,
            attackingBat: null,
            batAttackProgress: 0
        };
        
        // ========== –ú–û–ë–ò–õ–¨–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï ==========
        let joystickRect = null;
        let joystickCenterX = 0;
        let joystickCenterY = 0;
        let joystickRadius = 0;
        
        function updateJoystickPosition() {
            if (joystick) {
                const rect = joystick.getBoundingClientRect();
                joystickRect = rect;
                joystickCenterX = rect.left + rect.width / 2;
                joystickCenterY = rect.top + rect.height / 2;
                joystickRadius = rect.width / 2;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π –¥–ª—è –¥–∂–æ–π—Å—Ç–∏–∫–∞
        joystick.addEventListener('touchstart', function(e) {
            e.preventDefault();
            gameState.touch.joystick.active = true;
            updateJoystickPosition();
            handleJoystickTouch(e.touches[0]);
        });
        
        joystick.addEventListener('touchmove', function(e) {
            e.preventDefault();
            if (gameState.touch.joystick.active) {
                handleJoystickTouch(e.touches[0]);
            }
        });
        
        joystick.addEventListener('touchend', function(e) {
            e.preventDefault();
            gameState.touch.joystick.active = false;
            gameState.touch.joystick.x = 0;
            gameState.touch.joystick.y = 0;
            joystickHead.style.transform = 'translate(-50%, -50%)';
        });
        
        function handleJoystickTouch(touch) {
            if (!joystickRect) return;
            
            const touchX = touch.clientX;
            const touchY = touch.clientY;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –≤–µ–∫—Ç–æ—Ä –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –¥–∂–æ–π—Å—Ç–∏–∫–∞
            let dx = touchX - joystickCenterX;
            let dy = touchY - joystickCenterY;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–¥–∏—É—Å–æ–º –¥–∂–æ–π—Å—Ç–∏–∫–∞
            const distance = Math.sqrt(dx * dx + dy * dy);
            const maxDistance = joystickRadius * 0.7;
            
            if (distance > maxDistance) {
                dx = (dx / distance) * maxDistance;
                dy = (dy / distance) * maxDistance;
            }
            
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç -1 –¥–æ 1
            gameState.touch.joystick.x = dx / maxDistance;
            gameState.touch.joystick.y = dy / maxDistance;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–∂–æ–π—Å—Ç–∏–∫–∞
            const headX = (dx / joystickRadius) * 50;
            const headY = (dy / joystickRadius) * 50;
            joystickHead.style.transform = `translate(calc(-50% + ${headX}%), calc(-50% + ${headY}%))`;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
        btnShoot.addEventListener('touchstart', function(e) {
            e.preventDefault();
            gameState.touch.shoot = true;
            shootProjectile();
            this.style.transform = 'scale(0.95)';
        });
        
        btnShoot.addEventListener('touchend', function(e) {
            e.preventDefault();
            gameState.touch.shoot = false;
            this.style.transform = 'scale(1)';
        });
        
        btnAction.addEventListener('touchstart', function(e) {
            e.preventDefault();
            gameState.touch.action = true;
            gameState.keys.e = true;
            this.style.transform = 'scale(0.95)';
        });
        
        btnAction.addEventListener('touchend', function(e) {
            e.preventDefault();
            gameState.touch.action = false;
            gameState.keys.e = false;
            this.style.transform = 'scale(1)';
        });
        
        // –ö–Ω–æ–ø–∫–∞ –ø–∞—É–∑—ã
        btnPause.addEventListener('click', function() {
            togglePause();
        });
        
        resumeBtn.addEventListener('click', function() {
            togglePause();
        });
        
        restartPauseBtn.addEventListener('click', function() {
            togglePause();
            initGame();
        });
        
        quitBtn.addEventListener('click', function() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –º–æ–≥ –±—ã –±—ã—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
            alert('–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!');
        });
        
        function togglePause() {
            gameState.paused = !gameState.paused;
            if (gameState.paused) {
                pauseMenu.style.display = 'flex';
            } else {
                pauseMenu.style.display = 'none';
                if (!gameState.gameOver) {
                    requestAnimationFrame(gameLoop);
                }
            }
        }
        
        // ========== –û–°–ù–û–í–ù–û–ô –¶–ò–ö–õ ==========
        function gameLoop(timestamp) {
            if (gameState.paused || gameState.gameOver) return;
            
            const deltaTime = timestamp - gameState.lastUpdateTime;
            gameState.lastUpdateTime = timestamp;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
            if (isMobile || isTouchDevice) {
                updateMobileControls();
            }
            
            movePlayer();
            updateCamera();
            updateProjectiles();
            updateEnemies();
            updateRespawn();
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const dpr = window.devicePixelRatio || 1;
            ctx.save();
            ctx.scale(dpr, dpr);
            ctx.scale(camera.zoom, camera.zoom);
            
            drawMap();
            drawSpikes();
            drawChests();
            drawKeysAndExit();
            drawProjectiles();
            drawEnemies();
            drawPlayer();
            drawLaserSight();
            
            ctx.restore();
            
            requestAnimationFrame(gameLoop);
        }
        
        function updateMobileControls() {
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –¥–∂–æ–π—Å—Ç–∏–∫–∞ –≤ –∫–ª–∞–≤–∏—à–∏
            const joystick = gameState.touch.joystick;
            const deadzone = 0.2;
            
            gameState.keys.w = joystick.y < -deadzone;
            gameState.keys.s = joystick.y > deadzone;
            gameState.keys.a = joystick.x < -deadzone;
            gameState.keys.d = joystick.x > deadzone;
            
            // –ê–≤—Ç–æ-—Å—Ç—Ä–µ–ª—å–±–∞ –ø—Ä–∏ —É–¥–µ—Ä–∂–∞–Ω–∏–∏ –∫–Ω–æ–ø–∫–∏
            if (gameState.touch.shoot && gameState.player.canShoot) {
                const currentTime = Date.now();
                if (currentTime - gameState.player.lastShotTime > PLAYER_SHOOT_DELAY) {
                    shootProjectile();
                }
            }
        }
        
        // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∏–≥—Ä—ã –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ, –Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º gameState.TILE_SIZE –∏ –¥—Ä—É–≥–∏—Ö –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
        // ========== –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–ê–†–¢–´ ==========
        function generateMap() {
            console.log("–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã...");
            
            const map = [];
            const TILE_SIZE = gameState.TILE_SIZE;
            
            for (let y = 0; y < MAP_HEIGHT; y++) {
                map[y] = [];
                for (let x = 0; x < MAP_WIDTH; x++) {
                    map[y][x] = 1;
                }
            }
            
            const startX = 5;
            const startY = Math.floor(MAP_HEIGHT / 2);
            gameState.player.x = startX * TILE_SIZE + TILE_SIZE / 2;
            gameState.player.y = startY * TILE_SIZE + TILE_SIZE / 2;
            gameState.player.startX = gameState.player.x;
            gameState.player.startY = gameState.player.y;
            map[startY][startX] = 0;
            
            generateMaze(map, startX, startY);
            
            const spaces = createOpenSpaces(map);
            createSpikes(map, spaces);
            placeSmallKey(map);
            placeChests(map, spaces);
            placeMainKey(map);
            placeExit(map);
            createDoors(map);
            ensureAccessibility(map);
            
            console.log("–ö–∞—Ä—Ç–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞");
            return map;
        }
        
        function generateMaze(map, startX, startY) {
            const TILE_SIZE = gameState.TILE_SIZE;
            const stack = [{x: startX, y: startY}];
            const dirs = [[0,-2],[2,0],[0,2],[-2,0]];
            
            while (stack.length > 0) {
                const current = stack[stack.length-1];
                const neighbors = [];
                
                for (const [dx, dy] of dirs) {
                    const nx = current.x + dx;
                    const ny = current.y + dy;
                    const bx = current.x + dx/2;
                    const by = current.y + dy/2;
                    
                    if (nx > 1 && nx < MAP_WIDTH-2 && ny > 1 && ny < MAP_HEIGHT-2 && 
                        map[ny][nx] === 1 && map[by][bx] === 1) {
                        neighbors.push({nx, ny, bx, by});
                    }
                }
                
                if (neighbors.length > 0) {
                    const next = neighbors[Math.floor(Math.random()*neighbors.length)];
                    map[next.ny][next.nx] = 0;
                    map[next.by][next.bx] = 0;
                    stack.push({x: next.nx, y: next.ny});
                } else {
                    stack.pop();
                }
            }
            
            for (let i = 0; i < 150; i++) {
                const x = Math.floor(Math.random()*(MAP_WIDTH-4))+2;
                const y = Math.floor(Math.random()*(MAP_HEIGHT-4))+2;
                
                if (map[y][x] === 1) {
                    let walls = 0;
                    if (x>0 && map[y][x-1]===0) walls++;
                    if (x<MAP_WIDTH-1 && map[y][x+1]===0) walls++;
                    if (y>0 && map[y-1][x]===0) walls++;
                    if (y<MAP_HEIGHT-1 && map[y+1][x]===0) walls++;
                    
                    if (walls >= 2) map[y][x] = 0;
                }
            }
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º–∏, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç gameState.TILE_SIZE
        
        // ========== –û–¢–†–ò–°–û–í–ö–ê ==========
        function drawMap() {
            const scale = camera.zoom;
            const TILE_SIZE = gameState.TILE_SIZE;
            const startX = Math.max(0, Math.floor(camera.x/TILE_SIZE));
            const startY = Math.max(0, Math.floor(camera.y/TILE_SIZE));
            const endX = Math.min(MAP_WIDTH, Math.ceil((camera.x + camera.width/scale)/TILE_SIZE));
            const endY = Math.min(MAP_HEIGHT, Math.ceil((camera.y + camera.height/scale)/TILE_SIZE));
            
            for (let y = startY; y < endY; y++) {
                for (let x = startX; x < endX; x++) {
                    const tileX = x*TILE_SIZE - camera.x;
                    const tileY = y*TILE_SIZE - camera.y;
                    const tile = gameState.map[y][x];
                    
                    if (tile === 1) {
                        ctx.fillStyle = '#555555';
                        ctx.fillRect(tileX*scale, tileY*scale, TILE_SIZE*scale, TILE_SIZE*scale);
                        ctx.fillStyle = '#666666';
                        ctx.fillRect((tileX+2)*scale, (tileY+2)*scale, (TILE_SIZE-4)*scale, (TILE_SIZE-4)*scale);
                    } else if (tile === 2) {
                        ctx.fillStyle = gameState.player.hasSmallKey ? '#8B4513' : '#654321';
                        ctx.fillRect(tileX*scale, tileY*scale, TILE_SIZE*scale, TILE_SIZE*scale);
                        ctx.fillStyle = gameState.player.hasSmallKey ? '#A0522D' : '#8B4513';
                        ctx.fillRect((tileX+3)*scale, (tileY+3)*scale, (TILE_SIZE-6)*scale, (TILE_SIZE-6)*scale);
                    } else if (tile === 3) {
                        ctx.fillStyle = '#8B4513';
                        ctx.fillRect(tileX*scale, tileY*scale, TILE_SIZE*scale, TILE_SIZE*scale);
                        ctx.fillStyle = '#A0522D';
                        ctx.fillRect((tileX+6)*scale, (tileY+6)*scale, (TILE_SIZE-12)*scale, (TILE_SIZE-12)*scale);
                    } else if (tile === 0) {
                        ctx.fillStyle = '#333333';
                        ctx.fillRect(tileX*scale, tileY*scale, TILE_SIZE*scale, TILE_SIZE*scale);
                    }
                }
            }
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã...
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        function initGame() {
            updateGameSizes();
            
            gameState.player = {
                x: 0,
                y: 0,
                startX: 0,
                startY: 0,
                hasKey: false,
                hasSmallKey: false,
                lastShotTime: 0,
                canShoot: true,
                openingChest: null,
                chestProgress: 0,
                lives: PLAYER_LIVES,
                respawning: false,
                respawnTimer: 0,
                invulnerable: false,
                invulnerableTimer: 0
            };
            gameState.projectiles = [];
            gameState.enemyProjectiles = [];
            gameState.enemies = [];
            gameState.skeletons = [];
            gameState.bats = [];
            gameState.spikes = [];
            gameState.chests = [];
            gameState.key = null;
            gameState.smallKey = null;
            gameState.exit = null;
            gameState.doors = [];
            gameState.smallDoors = [];
            gameState.score = 0;
            gameState.gameOver = false;
            gameState.paused = false;
            gameState.chestsOpened = 0;
            gameState.chestsTotal = 3;
            gameState.lastUpdateTime = 0;
            gameState.crosshairVisible = true;
            gameState.attackingBat = null;
            gameState.batAttackProgress = 0;
            
            // –°–±—Ä–æ—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            gameState.keys = { w: false, a: false, s: false, d: false, e: false };
            gameState.touch = { joystick: { x: 0, y: 0, active: false }, shoot: false, action: false };
            
            gameState.map = generateMap();
            generateEnemies();
            
            camera.x = gameState.player.x - camera.width/(2*camera.zoom);
            camera.y = gameState.player.y - camera.height/(2*camera.zoom);
            
            updateChestIndicator();
            updateLivesIndicator();
            updateScoreIndicator();
            updateBatAttackIndicator();
            document.getElementById('chestProgress').style.display = 'none';
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('respawnScreen').style.display = 'none';
            pauseMenu.style.display = 'none';
            
            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø—Ä–∏—Ü–µ–ª –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            if (isMobile || isTouchDevice) {
                gameState.mouseX = canvas.width / 2;
                gameState.mouseY = canvas.height / 2;
                crosshair.style.left = '50%';
                crosshair.style.top = '50%';
            }
            
            updateJoystickPosition();
            
            if (!gameState.gameOver && !gameState.paused) {
                requestAnimationFrame(gameLoop);
            }
        }
        
        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï ==========
        document.addEventListener('keydown', (e) => {
            if (gameState.paused) return;
            
            const key = e.key.toLowerCase();
            if (key in gameState.keys) {
                gameState.keys[key] = true;
            }
            
            if (key === ' ' || key === 'spacebar') {
                shootProjectile();
                e.preventDefault();
            }
            
            if (key === 'r') {
                initGame();
            }
            
            if (key === 'escape' || key === 'p') {
                togglePause();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            if (key in gameState.keys) {
                gameState.keys[key] = false;
            }
        });
        
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            gameState.mouseX = e.clientX - rect.left;
            gameState.mouseY = e.clientY - rect.top;
            
            crosshair.style.left = gameState.mouseX + 'px';
            crosshair.style.top = gameState.mouseY + 'px';
        });
        
        canvas.addEventListener('mousedown', (e) => {
            if (e.button === 0) {
                shootProjectile();
                e.preventDefault();
            }
        });
        
        canvas.addEventListener('mouseenter', () => {
            gameState.crosshairVisible = true;
            crosshair.style.display = 'block';
        });
        
        canvas.addEventListener('mouseleave', () => {
            gameState.crosshairVisible = false;
            crosshair.style.display = 'none';
        });
        
        // –°–µ–Ω—Å–æ—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –≤—Å–µ–≥–æ —Ö–æ–ª—Å—Ç–∞
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (isMobile || isTouchDevice) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏—Ü–µ–ª–∞ –Ω–∞ –∫–∞—Å–∞–Ω–∏–µ
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                gameState.mouseX = touch.clientX - rect.left;
                gameState.mouseY = touch.clientY - rect.top;
                
                crosshair.style.left = gameState.mouseX + 'px';
                crosshair.style.top = gameState.mouseY + 'px';
                
                // –ï—Å–ª–∏ –∫–∞—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Å—Ç—Ä–µ–ª—è–µ–º
                const isOnJoystick = touch.clientX >= joystickRect?.left && 
                                    touch.clientX <= joystickRect?.right &&
                                    touch.clientY >= joystickRect?.top && 
                                    touch.clientY <= joystickRect?.bottom;
                
                const isOnButtons = touch.clientX >= mobileButtons.getBoundingClientRect().left &&
                                  touch.clientX <= mobileButtons.getBoundingClientRect().right &&
                                  touch.clientY >= mobileButtons.getBoundingClientRect().top && 
                                  touch.clientY <= mobileButtons.getBoundingClientRect().bottom;
                
                if (!isOnJoystick && !isOnButtons) {
                    shootProjectile();
                }
            }
        }, { passive: false });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (isMobile || isTouchDevice && !gameState.touch.joystick.active) {
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                gameState.mouseX = touch.clientX - rect.left;
                gameState.mouseY = touch.clientY - rect.top;
                
                crosshair.style.left = gameState.mouseX + 'px';
                crosshair.style.top = gameState.mouseY + 'px';
            }
        }, { passive: false });
        
        document.getElementById('restartBtn').addEventListener('click', initGame);
        
        window.addEventListener('load', function() {
            resizeCanvas();
            initGame();
            checkOrientation();
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        document.addEventListener('contextmenu', function(e) {
            if (isMobile || isTouchDevice) {
                e.preventDefault();
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
        gameState.mouseX = canvas.width / 2;
        gameState.mouseY = canvas.height / 2;
        crosshair.style.left = gameState.mouseX + 'px';
        crosshair.style.top = gameState.mouseY + 'px';
    </script>
</body>
</html>
