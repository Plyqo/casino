<!DOCTYPE html>
<html>
<head>
    <title>Neon Digital RPG</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Press+Start+2P&family=Ubuntu+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00ff9d;
            --secondary: #00b8ff;
            --accent: #ff00aa;
            --bg-dark: #0a0a1a;
            --bg-light: #1a1a2e;
            --text: #e0e0e0;
            --warning: #ff5555;
        }
        
        body {
            font-family: 'Ubuntu Mono', monospace;
            background: var(--bg-dark);
            color: var(--text);
            padding: 10px;
            margin: 0;
            line-height: 1.6;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        @media (min-width: 768px) {
            .container {
                grid-template-columns: 2fr 1fr;
            }
        }
        
        .panel {
            background: var(--bg-light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 157, 0.2);
        }
        
        h1, h2, h3 {
            font-family: 'Orbitron', sans-serif;
            color: var(--primary);
            margin-top: 0;
            text-shadow: 0 0 5px rgba(0, 255, 157, 0.5);
        }
        
        h1 {
            font-size: 1.8rem;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
        }
        
        h2 {
            font-size: 1.4rem;
        }
        
        h3 {
            font-size: 1.2rem;
            color: var(--secondary);
        }
        
        button {
            background: linear-gradient(145deg, #1a1a2e, #2a2a3e);
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            font-family: 'Ubuntu Mono', monospace;
            font-weight: bold;
            border-radius: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        button:hover {
            background: linear-gradient(145deg, #2a2a3e, #3a3a4e);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #555;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            font-size: 14px;
        }
        
        .stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            border-left: 3px solid var(--primary);
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--secondary);
            font-size: 1.1rem;
        }
        
        #combatLog {
            height: 150px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid rgba(0, 184, 255, 0.2);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7rem;
        }
        
        #combatLog div {
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px dotted rgba(255, 255, 255, 0.1);
        }
        
        #events {
            max-height: 200px;
            overflow-y: auto;
        }
        
        #events div {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            border-left: 3px solid var(--secondary);
        }
        
        #inventory {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(0, 255, 157, 0.1);
            position: relative;
        }
        
        .item-name {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .item-stats {
            font-size: 0.8rem;
            color: var(--secondary);
            margin-bottom: 8px;
        }
        
        .shop-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid rgba(0, 184, 255, 0.2);
        }
        
        .shop-item-name {
            font-weight: bold;
            color: var(--text);
            margin-bottom: 5px;
        }
        
        .shop-item-price {
            color: var(--primary);
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .energy-low {
            color: var(--warning);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .tutorial {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-light);
            padding: 20px;
            z-index: 100;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.3);
            border: 2px solid var(--primary);
        }
        
        .tutorial h3 {
            color: var(--accent);
            text-align: center;
        }
        
        .tutorial-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .tutorial-next {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        #closeTutorial {
            background: var(--accent);
            color: white;
            border: none;
            float: right;
        }
        
        .health-bar {
            height: 10px;
            background: rgba(255, 0, 0, 0.2);
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff5555, #ff0000);
            width: 100%;
            transition: width 0.3s ease;
        }
        
        .energy-bar {
            height: 10px;
            background: rgba(0, 184, 255, 0.2);
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b8ff, #0088cc);
            width: 100%;
            transition: width 0.3s ease;
        }
        
        .boss-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-light);
            padding: 20px;
            z-index: 100;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 20px rgba(255, 0, 170, 0.5);
            border: 2px solid var(--accent);
        }
        
        .boss-option {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid var(--accent);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .boss-option:hover {
            background: rgba(255, 0, 170, 0.1);
            transform: translateX(5px);
        }
        
        .boss-option h4 {
            color: var(--accent);
            margin-top: 0;
        }
        
        .boss-option.easy {
            border-left-color: #00ff9d;
        }
        
        .boss-option.medium {
            border-left-color: #00b8ff;
        }
        
        .boss-option.hard {
            border-left-color: #ff5555;
        }
        
        .rare-item {
            border: 1px solid #00b8ff;
            box-shadow: 0 0 10px rgba(0, 184, 255, 0.3);
        }
        
        .epic-item {
            border: 1px solid #aa00ff;
            box-shadow: 0 0 10px rgba(170, 0, 255, 0.3);
        }
        
        .legendary-item {
            border: 1px solid #ffaa00;
            box-shadow: 0 0 10px rgba(255, 170, 0, 0.3);
        }
        
        .minigame-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-light);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--accent);
            z-index: 1000;
            text-align: center;
        }
        
        .minigame-target {
            width: 100px;
            height: 100px;
            background: var(--accent);
            border-radius: 50%;
            margin: 20px auto;
            cursor: pointer;
            transition: all 0.1s;
        }
        
        .minigame-timer {
            height: 5px;
            background: var(--primary);
            margin-top: 10px;
            transition: width 1s linear;
        }
        
        .magic-progress {
            height: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .magic-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #aa00ff, #ff00aa);
            width: 0%;
            transition: width 0.3s;
        }
        
        .rest-cooldown {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 0 0 5px 5px;
            overflow: hidden;
        }
        
        .rest-cooldown-fill {
            height: 100%;
            background: var(--secondary);
            width: 100%;
            transition: width 1s linear;
        }
        
        .xp-bar {
            height: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffaa00, #ff5500);
            width: 0%;
            transition: width 0.3s;
        }
        
        .location-selector {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
        }
        
        .location-btn {
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .location-btn.active {
            transform: translateY(-3px);
            box-shadow: 0 0 10px currentColor;
        }
        
        .easy-location {
            background: rgba(0, 255, 157, 0.1);
            border: 1px solid #00ff9d;
            color: #00ff9d;
        }
        
        .medium-location {
            background: rgba(0, 184, 255, 0.1);
            border: 1px solid #00b8ff;
            color: #00b8ff;
        }
        
        .hard-location {
            background: rgba(255, 0, 170, 0.1);
            border: 1px solid #ff00aa;
            color: #ff00aa;
        }
        
        .hell-location {
            background: rgba(255, 85, 85, 0.1);
            border: 1px solid #ff5555;
            color: #ff5555;
        }
        
        .sell-btn {
            background: rgba(255, 85, 85, 0.2);
            border: 1px solid #ff5555;
            color: #ff5555;
            padding: 5px;
            font-size: 0.8rem;
            margin-top: 5px;
            width: 100%;
        }
        
        .magic-effect {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(170, 0, 255, 0.2);
            z-index: 999;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
        }
    </style>
</head>
<body>
    <div class="magic-effect" id="magicEffect"></div>
    
    <div class="tutorial" id="tutorial">
        <button id="closeTutorial" onclick="closeTutorial()">X</button>
        <h3>–¶–ò–§–†–û–í–û–ô –ì–ò–î</h3>
        <div id="tutorialText">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–π –º–∏—Ä!</div>
        <div class="tutorial-controls">
            <button class="tutorial-next" onclick="nextTutorialStep()">‚û°Ô∏è</button>
        </div>
    </div>

    <div class="boss-panel" id="bossPanel">
        <h3>–í–´–ó–í–ê–¢–¨ –ë–û–°–°–ê</h3>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</p>
        
        <div class="boss-option easy" onclick="startBossFight(1)">
            <h4>–û–±—ã—á–Ω—ã–π –±–æ—Å—Å</h4>
            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 500üß©</p>
            <p>–ù–∞–≥—Ä–∞–¥–∞: 150-300üí∞, 5-10üß©, —Ä–µ–¥–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç</p>
        </div>
        
        <div class="boss-option medium" onclick="startBossFight(2)">
            <h4>–°—Ä–µ–¥–Ω–∏–π –±–æ—Å—Å</h4>
            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 1000üß©</p>
            <p>–ù–∞–≥—Ä–∞–¥–∞: 300-500üí∞, 10-15üß©, —ç–ø–∏—á–µ—Å–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç</p>
        </div>
        
        <div class="boss-option hard" onclick="startBossFight(3)">
            <h4>–ü–µ—Ä–≤–æ–∫–ª–∞—Å—Å–Ω—ã–π —É–±–∏–π—Ü–∞</h4>
            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 2500üß©</p>
            <p>–ù–∞–≥—Ä–∞–¥–∞: 500-1000üí∞, 15-25üß©, –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç</p>
        </div>
        
        <button onclick="closeBossPanel()" style="margin-top: 15px;">–û—Ç–º–µ–Ω–∞</button>
    </div>

    <div class="minigame-container" id="minigameContainer">
        <h3>–ú–ò–ù–ò-–ò–ì–†–ê: –ù–ê–ù–ï–°–ï–ù–ò–ï –£–î–ê–†–ê</h3>
        <p>–ö–ª–∏–∫–Ω–∏ –ø–æ —Ü–µ–ª–∏ –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç!</p>
        <div class="minigame-target" id="minigameTarget" onclick="minigameClick()"></div>
        <div class="minigame-timer" id="minigameTimer"></div>
        <p id="minigameResult"></p>
    </div>

    <div class="container">
        <div>
            <div class="panel">
                <h1>NEON DIGITAL RPG</h1>
                <div class="location-selector">
                    <button class="location-btn easy-location active" onclick="changeLocation(0)">–û–±—ã—á–Ω—ã–π –º–∏—Ä</button>
                    <button class="location-btn medium-location" onclick="changeLocation(1)">–ü–æ–¥–∑–µ–º–µ–ª—å–µ</button>
                    <button class="location-btn hard-location" onclick="changeLocation(2)">–ò–Ω–æ–π –º–∏—Ä</button>
                    <button class="location-btn hell-location" onclick="changeLocation(3)">–ê–¥</button>
                </div>
                <div class="grid">
                    <div class="stat">
                        <div>–£–†–û–í–ï–ù–¨</div>
                        <div class="stat-value" id="level">1</div>
                        <div class="xp-bar">
                            <div class="xp-fill" id="xpBar"></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div>–ó–î–û–†–û–í–¨–ï</div>
                        <div class="stat-value" id="hp">100/100</div>
                        <div class="health-bar">
                            <div class="health-fill" id="healthBar"></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div>–ê–¢–ê–ö–ê</div>
                        <div class="stat-value" id="atk">15</div>
                    </div>
                    <div class="stat">
                        <div>–ó–ê–©–ò–¢–ê</div>
                        <div class="stat-value" id="def">5</div>
                    </div>
                    <div class="stat">
                        <div>–ó–û–õ–û–¢–û</div>
                        <div class="stat-value" id="gold">50</div>
                    </div>
                    <div class="stat">
                        <div>–ö–û–î–´</div>
                        <div class="stat-value" id="codes">0</div>
                    </div>
                    <div class="stat">
                        <div>–≠–ù–ï–†–ì–ò–Ø</div>
                        <div class="stat-value" id="energy">100</div>
                        <div class="energy-bar">
                            <div class="energy-fill" id="energyBar"></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div>–ú–ê–ì–ò–Ø</div>
                        <div class="stat-value" id="magicLevel">0</div>
                        <div class="magic-progress">
                            <div class="magic-progress-fill" id="magicProgress"></div>
                        </div>
                    </div>
                </div>
                <div id="combatLog"></div>
            </div>
            
            <div class="panel">
                <h2>–î–ï–ô–°–¢–í–ò–Ø</h2>
                <div class="grid">
                    <button onclick="explore()">[1] –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å</button>
                    <button onclick="craft()">[2] –ö—Ä–∞—Ñ—Ç</button>
                    <button onclick="openShop()">[3] –ú–∞–≥–∞–∑–∏–Ω</button>
                    <button onclick="rest()" id="restButton">[4] –û—Ç–¥—ã—Ö
                        <div class="rest-cooldown" id="restCooldown">
                            <div class="rest-cooldown-fill" id="restCooldownFill"></div>
                        </div>
                    </button>
                    <button onclick="openBossPanel()" style="background: var(--accent);">[5] –í—ã–∑–≤–∞—Ç—å –±–æ—Å—Å–∞</button>
                    <button onclick="useMagic()" id="magicButton" disabled>[6] –ò—Å–ø. –º–∞–≥–∏—é</button>
                </div>
            </div>
        </div>

        <div>
            <div class="panel" id="shopPanel" style="display:none">
                <h2>–¶–ò–§–†–û–í–û–ô –ú–ê–†–ö–ï–¢</h2>
                <div class="grid" id="shopItems"></div>
            </div>
            
            <div class="panel">
                <h2>–ò–ù–í–ï–ù–¢–ê–†–¨</h2>
                <div id="inventory"></div>
            </div>
            
            <div class="panel">
                <h2>–°–ò–°–¢–ï–ú–ù–´–ô –ñ–£–†–ù–ê–õ</h2>
                <div id="events"></div>
            </div>
        </div>
    </div>

<script>
const game = {
    player: {
        level: 1,
        xp: 0,
        xpToNextLevel: 100,
        hp: 100,
        maxHp: 100,
        atk: 15,
        def: 5,
        gold: 50,
        codes: 0,
        energy: 100,
        magic: {
            learned: false,
            level: 0,
            progress: 0,
            learning: false,
            learnEndTime: 0,
            active: false,
            endTime: 0,
            bonusAtk: 0
        },
        inventory: [],
        equipment: {
            weapon: null,
            armor: null,
            artifact: null
        },
        restCooldown: 0,
        lastRestTime: 0,
        currentLocation: 0
    },
    locations: [
        { name: "–û–±—ã—á–Ω—ã–π –º–∏—Ä", difficulty: "easy", energyCost: 10 },
        { name: "–ü–æ–¥–∑–µ–º–µ–ª—å–µ", difficulty: "medium", energyCost: 15 },
        { name: "–ò–Ω–æ–π –º–∏—Ä", difficulty: "hard", energyCost: 20 },
        { name: "–ê–¥", difficulty: "hell", energyCost: 30 }
    ],
    craftingRecipes: {
        '1010+0101': {type: 'weapon', name: '–ú–µ—á 1010', atk: 20, rarity: 'rare', value: 150},
        '1110+0011': {type: 'armor', name: '–ë—Ä–æ–Ω—è 1110', def: 15, rarity: 'rare', value: 150},
        '1001+0110': {type: 'weapon', name: '–ö–∏–Ω–∂–∞–ª 0110', atk: 25, rarity: 'epic', value: 300},
        '1100+0011': {type: 'armor', name: '–©–∏—Ç 0011', def: 20, rarity: 'epic', value: 300},
        '1011+1101': {type: 'artifact', name: '–ê—Ä—Ç–µ—Ñ–∞–∫—Ç 1101', bonus: '10% –∫ –∞—Ç–∞–∫–µ', rarity: 'legendary', value: 600},
        '0000+1111': {type: 'weapon', name: '–ú–µ—á –†–∞–≤–Ω–æ–≤–µ—Å–∏—è', atk: 30, def: 10, rarity: 'epic', value: 400},
        '0101+1010': {type: 'armor', name: '–ë—Ä–æ–Ω—è –ì–∞—Ä–º–æ–Ω–∏–∏', def: 25, hp: 20, rarity: 'epic', value: 400},
        '1111+0000': {type: 'artifact', name: '–Ø–¥—Ä–æ –•–∞–æ—Å–∞', bonus: '+15% –∫ —É—Ä–æ–Ω—É', rarity: 'legendary', value: 800},
        '1000+0111': {type: 'weapon', name: '–õ—É–∫ –¢—å–º—ã', atk: 35, rarity: 'epic', value: 350},
        '0111+1000': {type: 'armor', name: '–ù–∞–≥—Ä—É–¥–Ω–∏–∫ –°–≤–µ—Ç–∞', def: 30, rarity: 'epic', value: 350}
    },
    enemies: {
        easy: [
            {name: '–í–∏—Ä—É—Å 0101', hp: 30, atk: 8, gold: 15, xp: 10, color: '#ff5555'},
            {name: '–ß–µ—Ä–≤—å 1110', hp: 45, atk: 12, gold: 25, xp: 20, color: '#ffaa00'},
            {name: '–¢—Ä–æ—è–Ω 0010', hp: 60, atk: 18, gold: 40, xp: 35, color: '#ff00aa'},
            {name: '–ë–æ—Ç–Ω–µ—Ç 1101', hp: 80, atk: 22, gold: 60, xp: 50, color: '#aa00ff'},
            {name: '–†—É—Ç–∫–∏—Ç 1011', hp: 100, atk: 28, gold: 80, xp: 70, color: '#00aaff'},
            {name: '–®–ø–∏–æ–Ω 0111', hp: 50, atk: 30, gold: 70, xp: 60, color: '#00ffaa'},
            {name: '–ö–µ–π–ª–æ–≥–µ—Ä 1000', hp: 120, atk: 25, gold: 90, xp: 80, color: '#ff5500'},
            {name: '–ì–ª–∏—Ç—á 0001', hp: 40, atk: 15, gold: 20, xp: 15, color: '#55ff00'},
            {name: '–õ–∞–≥ 1010', hp: 55, atk: 10, gold: 30, xp: 25, color: '#ff00ff'},
            {name: '–ë–∞–≥ 0100', hp: 70, atk: 20, gold: 50, xp: 40, color: '#00ffff'},
            {name: '–ö—Ä–∞–∫–µ—Ä 1100', hp: 90, atk: 25, gold: 70, xp: 60, color: '#ffff00'},
            {name: '–°–ø–∞–º 0011', hp: 35, atk: 12, gold: 25, xp: 20, color: '#aa55ff'},
            {name: '–§–∏—à–∏–Ω–≥ 0110', hp: 65, atk: 18, gold: 45, xp: 35, color: '#ffaa55'},
            {name: '–≠–∫—Å–ø–ª–æ–π—Ç 1001', hp: 85, atk: 22, gold: 65, xp: 55, color: '#55aaff'},
            {name: '–î–î–æ–° 1111', hp: 110, atk: 30, gold: 85, xp: 75, color: '#ff55aa'}
        ],
        medium: [
            {name: '–¢–µ–Ω–µ–≤–æ–π –ì–æ–ª–µ–º', hp: 150, atk: 35, gold: 120, xp: 100, color: '#555555', dropChance: 0.3},
            {name: '–ö–∞–º–µ–Ω–Ω—ã–π –°—Ç—Ä–∞–∂', hp: 180, atk: 40, gold: 150, xp: 120, color: '#888888', dropChance: 0.3},
            {name: '–ü–æ–¥–∑–µ–º–Ω—ã–π –î–µ–º–æ–Ω', hp: 200, atk: 45, gold: 180, xp: 140, color: '#aa0000', dropChance: 0.3},
            {name: '–ö—Ä–∏—Å—Ç–∞–ª—å–Ω—ã–π –°–∫–µ–ª–µ—Ç', hp: 170, atk: 38, gold: 140, xp: 110, color: '#00aaaa', dropChance: 0.3},
            {name: '–¢–µ–º–Ω—ã–π –†—ã—Ü–∞—Ä—å', hp: 190, atk: 42, gold: 160, xp: 130, color: '#333333', dropChance: 0.3},
            {name: '–õ–∞–≤–æ–≤—ã–π –ß–µ—Ä–≤—è–∫', hp: 160, atk: 37, gold: 130, xp: 105, color: '#ff5500', dropChance: 0.3},
            {name: '–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –í–æ–∏–Ω', hp: 140, atk: 33, gold: 110, xp: 95, color: '#aaaaaa', dropChance: 0.3},
            {name: '–Ø–¥–æ–≤–∏—Ç—ã–π –ü–∞—É–∫', hp: 130, atk: 32, gold: 100, xp: 90, color: '#55aa00', dropChance: 0.3},
            {name: '–ü–æ–¥–∑–µ–º–Ω—ã–π –î—Ä–∞–∫–æ–Ω', hp: 220, atk: 50, gold: 200, xp: 160, color: '#aa5500', dropChance: 0.4},
            {name: '–ö–æ—Å—Ç—è–Ω–æ–π –ö–æ–ª–¥—É–Ω', hp: 180, atk: 45, gold: 170, xp: 140, color: '#ffffff', dropChance: 0.4},
            {name: '–¢–µ–º–Ω—ã–π –≠–ª–µ–º–µ–Ω—Ç–∞–ª—å', hp: 200, atk: 48, gold: 190, xp: 150, color: '#0000aa', dropChance: 0.4},
            {name: '–ñ–µ–ª–µ–∑–Ω—ã–π –ì–æ–ª–µ–º', hp: 250, atk: 55, gold: 220, xp: 180, color: '#aaaaaa', dropChance: 0.4},
            {name: '–ö–æ—Ä–æ–ª—å –ü–æ–¥–∑–µ–º–µ–ª—å—è', hp: 300, atk: 60, gold: 250, xp: 200, color: '#ffaa00', dropChance: 0.5}
        ],
        hard: [
            {name: '–ò–Ω–æ–º–∏—Ä–æ–≤–æ–π –£–∂–∞—Å', hp: 300, atk: 60, gold: 250, xp: 200, color: '#aa00ff', dropChance: 0.5},
            {name: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –õ–µ–≤–∏–∞—Ñ–∞–Ω', hp: 350, atk: 65, gold: 280, xp: 220, color: '#00aaff', dropChance: 0.5},
            {name: '–î—Ä–µ–≤–Ω–∏–π –°—Ç—Ä–∞–Ω–Ω–∏–∫', hp: 320, atk: 62, gold: 260, xp: 210, color: '#ff00aa', dropChance: 0.5},
            {name: '–ó–≤–µ–∑–¥–Ω—ã–π –ü–æ–∂–∏—Ä–∞—Ç–µ–ª—å', hp: 380, atk: 70, gold: 300, xp: 240, color: '#ffff00', dropChance: 0.5},
            {name: '–¢–µ–º–Ω—ã–π –ö–æ—Å–º–æ–Ω–∞–≤—Ç', hp: 310, atk: 63, gold: 270, xp: 215, color: '#00ffaa', dropChance: 0.5},
            {name: '–ò—Å–∫–∞–∂–µ–Ω–Ω—ã–π –ê–Ω–≥–µ–ª', hp: 340, atk: 68, gold: 290, xp: 230, color: '#ffaa00', dropChance: 0.5},
            {name: '–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –†–∞–∑—Ä—ã–≤', hp: 360, atk: 72, gold: 310, xp: 250, color: '#aa55ff', dropChance: 0.6},
            {name: '–•—Ä–∞–Ω–∏—Ç–µ–ª—å –ü–æ—Ä–æ–≥–∞', hp: 400, atk: 75, gold: 350, xp: 280, color: '#55aaff', dropChance: 0.6},
            {name: '–ë–µ–∑—É–º–Ω—ã–π –ü—Ä–æ—Ä–æ–∫', hp: 330, atk: 66, gold: 280, xp: 225, color: '#ff55aa', dropChance: 0.6},
            {name: '–ò–Ω–æ–º–∏—Ä–æ–≤–æ–π –í–∏—Ä—É—Å', hp: 370, atk: 73, gold: 320, xp: 260, color: '#55ffaa', dropChance: 0.6},
            {name: '–ö–≤–∞–Ω—Ç–æ–≤—ã–π –ü—Ä–∏–∑—Ä–∞–∫', hp: 390, atk: 78, gold: 340, xp: 270, color: '#aaff55', dropChance: 0.6},
            {name: '–¢–µ–º–Ω–∞—è –ú–∞—Ç–µ—Ä–∏—è', hp: 420, atk: 80, gold: 370, xp: 300, color: '#000000', dropChance: 0.7},
            {name: '–ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ù—É–ª—å', hp: 450, atk: 85, gold: 400, xp: 330, color: '#ffffff', dropChance: 0.7},
            {name: '–ß–µ—Ä–Ω–∞—è –î—ã—Ä–∞', hp: 500, atk: 90, gold: 450, xp: 350, color: '#5500aa', dropChance: 0.7},
            {name: '–°–≤–µ—Ä—Ö–Ω–æ–≤–∞—è', hp: 480, atk: 88, gold: 420, xp: 340, color: '#ff0055', dropChance: 0.7},
            {name: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –î—Ä–∞–∫–æ–Ω', hp: 550, atk: 95, gold: 500, xp: 400, color: '#00aaff', dropChance: 0.8},
            {name: '–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å –ò–Ω–æ–≥–æ –ú–∏—Ä–∞', hp: 600, atk: 100, gold: 550, xp: 450, color: '#ff00ff', dropChance: 0.8}
        ],
        hell: [
            {name: '–ê–¥—Å–∫–∏–π –ü–µ—Å', hp: 600, atk: 100, gold: 500, xp: 400, color: '#ff5500', dropChance: 0.8},
            {name: '–ì–Ω–µ–≤–Ω—ã–π –î–µ–º–æ–Ω', hp: 650, atk: 110, gold: 550, xp: 450, color: '#ff0000', dropChance: 0.8},
            {name: '–ü–∞–ª–∞–¥–∏–Ω –ê–¥–∞', hp: 700, atk: 115, gold: 600, xp: 500, color: '#aa0000', dropChance: 0.8},
            {name: '–õ–∞–≤–æ–≤—ã–π –¢–∏—Ç–∞–Ω', hp: 750, atk: 120, gold: 650, xp: 550, color: '#ffaa00', dropChance: 0.8},
            {name: '–ö–æ—Å—Ç—è–Ω–æ–π –î—Ä–∞–∫–æ–Ω', hp: 800, atk: 125, gold: 700, xp: 600, color: '#ffffff', dropChance: 0.8},
            {name: '–¢–µ–º–Ω—ã–π –í–ª–∞—Å—Ç–µ–ª–∏–Ω', hp: 850, atk: 130, gold: 750, xp: 650, color: '#000000', dropChance: 0.9},
            {name: '–ö–Ω—è–∑—å –¢—å–º—ã', hp: 900, atk: 135, gold: 800, xp: 700, color: '#5500aa', dropChance: 0.9},
            {name: '–ê–¥—Å–∫–∏–π –†—ã—Ü–∞—Ä—å', hp: 950, atk: 140, gold: 850, xp: 750, color: '#aa0000', dropChance: 0.9},
            {name: '–î–µ–º–æ–Ω –ë–µ–∑–¥–Ω—ã', hp: 1000, atk: 145, gold: 900, xp: 800, color: '#ff0055', dropChance: 0.9},
            {name: '–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å –ë–æ–ª–∏', hp: 1100, atk: 150, gold: 1000, xp: 900, color: '#ff00ff', dropChance: 1.0},
            {name: '–°—Ç—Ä–∞–∂–∞ –ü—Ä–µ–∏—Å–ø–æ–¥–Ω–µ–π', hp: 1200, atk: 160, gold: 1100, xp: 1000, color: '#aa00ff', dropChance: 1.0},
            {name: '–î—É—Ö –ú—â–µ–Ω–∏—è', hp: 1300, atk: 170, gold: 1200, xp: 1100, color: '#00aaff', dropChance: 1.0},
            {name: '–¢–µ–Ω—å –°–º–µ—Ä—Ç–∏', hp: 1400, atk: 180, gold: 1300, xp: 1200, color: '#000000', dropChance: 1.0},
            {name: '–û–≥–Ω–µ–Ω–Ω—ã–π –ö–æ–ª–æ—Å—Å', hp: 1500, atk: 190, gold: 1400, xp: 1300, color: '#ff5500', dropChance: 1.0},
            {name: '–õ–µ–¥—è–Ω–æ–π –ü–∞–ª–∞—á', hp: 1600, atk: 200, gold: 1500, xp: 1400, color: '#00aaff', dropChance: 1.0},
            {name: '–ö—Ä–æ–≤–∞–≤—ã–π –ñ–Ω–µ—Ü', hp: 1700, atk: 210, gold: 1600, xp: 1500, color: '#ff0000', dropChance: 1.0},
            {name: '–î—É—à–µ–≥—É–±', hp: 1800, atk: 220, gold: 1700, xp: 1600, color: '#aa0000', dropChance: 1.0},
            {name: '–ö–æ—Å—Ç—è–Ω–æ–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä', hp: 1900, atk: 230, gold: 1800, xp: 1700, color: '#ffffff', dropChance: 1.0},
            {name: '–¢–µ–º–Ω—ã–π –ê—Ä—Ö–∞–Ω–≥–µ–ª', hp: 2000, atk: 240, gold: 1900, xp: 1800, color: '#000000', dropChance: 1.0},
            {name: '–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å –î–µ–º–æ–Ω–æ–≤', hp: 2200, atk: 250, gold: 2000, xp: 2000, color: '#ff00aa', dropChance: 1.0},
            {name: '–°–∞–º—Å–∞—Ä–∞', hp: 2500, atk: 270, gold: 2200, xp: 2200, color: '#aa00ff', dropChance: 1.0},
            {name: '–õ—é—Ü–∏—Ñ–µ—Ä', hp: 3000, atk: 300, gold: 2500, xp: 2500, color: '#ff0000', dropChance: 1.0},
            {name: '–°–ê–¢–ê–ù–ê', hp: 5000, atk: 400, gold: 5000, xp: 5000, color: '#aa0000', dropChance: 1.0}
        ]
    },
    shopItems: [
        {name: '–õ–µ—á–µ–Ω–∏–µ (+50HP)', costGold: 30, costCodes: 5, type: 'heal', icon: '‚ù§Ô∏è'},
        {name: '–ö–æ–¥-—Ñ—Ä–∞–≥–º–µ–Ω—Ç x5', costGold: 40, costCodes: 0, type: 'code', icon: 'üß©'},
        {name: '–£–ª—É—á—à–µ–Ω–∏–µ –∞—Ç–∞–∫–∏', costGold: 100, costCodes: 20, type: 'atk', icon: '‚öîÔ∏è'},
        {name: '–£–ª—É—á—à–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã', costGold: 100, costCodes: 20, type: 'def', icon: 'üõ°Ô∏è'},
        {name: '–≠–Ω–µ—Ä–≥–∏—è (+50üîã)', costGold: 40, costCodes: 10, type: 'energy', icon: 'üîã'},
        {name: '–†–µ–º–æ–Ω—Ç (–ø–æ–ª–Ω–æ–µ HP)', costGold: 150, costCodes: 30, type: 'fullheal', icon: 'üíä'},
        {name: '–ò–∑—É—á–µ–Ω–∏–µ –º–∞–≥–∏–∏', costGold: 500, costCodes: 500, type: 'learnMagic', icon: 'üîÆ'},
        {name: '–£–ª—É—á—à–µ–Ω–∏–µ –º–∞–≥–∏–∏', costGold: 1000, costCodes: 1000, type: 'upgradeMagic', icon: '‚ú®'},
        {name: '–ú–µ—á –ù–∞—á–∏–Ω–∞—é—â–µ–≥–æ', costGold: 200, costCodes: 50, type: 'weapon', atk: 15, rarity: 'common', icon: '‚öîÔ∏è'},
        {name: '–ö–æ–∂–∞–Ω–∞—è –ë—Ä–æ–Ω—è', costGold: 150, costCodes: 40, type: 'armor', def: 10, rarity: 'common', icon: 'üõ°Ô∏è'},
        {name: '–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –©–∏—Ç', costGold: 100, costCodes: 30, type: 'armor', def: 8, rarity: 'common', icon: 'üõ°Ô∏è'},
        {name: '–ö–∏–Ω–∂–∞–ª –¢–µ–Ω–∏', costGold: 300, costCodes: 100, type: 'weapon', atk: 25, rarity: 'rare', icon: 'üó°Ô∏è'},
        {name: '–°—Ç–∞–ª—å–Ω–æ–π –ú–µ—á', costGold: 400, costCodes: 150, type: 'weapon', atk: 30, rarity: 'rare', icon: '‚öîÔ∏è'},
        {name: '–ú–∏—Ñ—Ä–∏–ª–æ–≤–∞—è –ë—Ä–æ–Ω—è', costGold: 500, costCodes: 200, type: 'armor', def: 25, rarity: 'rare', icon: 'üõ°Ô∏è'}
    ],
    bossItems: {
        rare: [
            {type: 'weapon', name: '–ú–µ—á –ë–æ—Å—Å–∞', atk: 30, rarity: 'rare', value: 300},
            {type: 'armor', name: '–ë—Ä–æ–Ω—è –ë–æ—Å—Å–∞', def: 25, rarity: 'rare', value: 300},
            {type: 'artifact', name: '–¢—Ä–æ—Ñ–µ–π –ë–æ—Å—Å–∞', bonus: '+15% –∫ –∑–æ–ª–æ—Ç—É', rarity: 'rare', value: 300}
        ],
        epic: [
            {type: 'weapon', name: '–≠–ø–∏—á–µ—Å–∫–∏–π –ú–µ—á', atk: 45, rarity: 'epic', value: 600},
            {type: 'armor', name: '–≠–ø–∏—á–µ—Å–∫–∞—è –ë—Ä–æ–Ω—è', def: 35, rarity: 'epic', value: 600},
            {type: 'artifact', name: '–≠–ø–∏—á–µ—Å–∫–∏–π –¢—Ä–æ—Ñ–µ–π', bonus: '+25% –∫ –æ–ø—ã—Ç—É', rarity: 'epic', value: 600}
        ],
        legendary: [
            {type: 'weapon', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ú–µ—á', atk: 65, rarity: 'legendary', value: 1200},
            {type: 'armor', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –ë—Ä–æ–Ω—è', def: 50, rarity: 'legendary', value: 1200},
            {type: 'artifact', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –¢—Ä–æ—Ñ–µ–π', bonus: '+50% –∫ –∞—Ç–∞–∫–µ', rarity: 'legendary', value: 1200}
        ]
    },
    lootItems: [
        {type: 'weapon', name: '–†–∂–∞–≤—ã–π –ú–µ—á', atk: 5, rarity: 'common', value: 50},
        {type: 'weapon', name: '–û—Å—Ç—Ä—ã–π –ö–∏–Ω–∂–∞–ª', atk: 10, rarity: 'common', value: 100},
        {type: 'weapon', name: '–ë–æ–µ–≤–æ–π –¢–æ–ø–æ—Ä', atk: 15, rarity: 'common', value: 150},
        {type: 'weapon', name: '–î–ª–∏–Ω–Ω—ã–π –õ—É–∫', atk: 20, rarity: 'rare', value: 200},
        {type: 'weapon', name: '–ü–æ—Å–æ—Ö –ú–∞–≥–∞', atk: 25, magic: 10, rarity: 'rare', value: 250},
        {type: 'weapon', name: '–î–≤—É—Ä—É—á–Ω—ã–π –ú–µ—á', atk: 30, rarity: 'rare', value: 300},
        {type: 'weapon', name: '–ê—Ä–±–∞–ª–µ—Ç –°–Ω–∞–π–ø–µ—Ä–∞', atk: 35, rarity: 'epic', value: 350},
        {type: 'weapon', name: '–ö–ª–∏–Ω–æ–∫ –¢–µ–Ω–µ–π', atk: 40, rarity: 'epic', value: 400},
        {type: 'weapon', name: '–ú–æ–ª–æ—Ç –ì—Ä–æ–º–∞', atk: 45, rarity: 'epic', value: 450},
        {type: 'weapon', name: '–ö–æ—Å–∞ –°–º–µ—Ä—Ç–∏', atk: 50, rarity: 'legendary', value: 500},
        
        {type: 'armor', name: '–ö–æ–∂–∞–Ω—ã–π –î–æ—Å–ø–µ—Ö', def: 5, rarity: 'common', value: 50},
        {type: 'armor', name: '–ö–æ–ª—å—á—É–≥–∞', def: 10, rarity: 'common', value: 100},
        {type: 'armor', name: '–ß–µ—à—É–π—á–∞—Ç–∞—è –ë—Ä–æ–Ω—è', def: 15, rarity: 'common', value: 150},
        {type: 'armor', name: '–ü–ª–∞—Å—Ç–∏–Ω—á–∞—Ç—ã–π –î–æ—Å–ø–µ—Ö', def: 20, rarity: 'rare', value: 200},
        {type: 'armor', name: '–ú–∏—Ñ—Ä–∏–ª–æ–≤–∞—è –ë—Ä–æ–Ω—è', def: 25, rarity: 'rare', value: 250},
        {type: 'armor', name: '–î—Ä–∞–∫–æ–Ω–∏–π –©–∏—Ç', def: 30, rarity: 'rare', value: 300},
        {type: 'armor', name: '–ë—Ä–æ–Ω—è –ì–∏–≥–∞–Ω—Ç–∞', def: 35, rarity: 'epic', value: 350},
        {type: 'armor', name: '–î–æ—Å–ø–µ—Ö –í–∞–ª—å–∫–∏—Ä–∏–∏', def: 40, rarity: 'epic', value: 400},
        {type: 'armor', name: '–ê–¥–∞–º–∞–Ω—Ç–∏–Ω–æ–≤–∞—è –ë—Ä–æ–Ω—è', def: 45, rarity: 'epic', value: 450},
        {type: 'armor', name: '–ë—Ä–æ–Ω—è –ù–µ–±–µ—Å', def: 50, rarity: 'legendary', value: 500},
        
        {type: 'artifact', name: '–ö–æ–ª—å—Ü–æ –°–∏–ª—ã', bonus: '+10% –∫ –∞—Ç–∞–∫–µ', rarity: 'rare', value: 200},
        {type: 'artifact', name: '–ê–º—É–ª–µ—Ç –ñ–∏–∑–Ω–∏', bonus: '+20 –∫ –∑–¥–æ—Ä–æ–≤—å—é', rarity: 'rare', value: 200},
        {type: 'artifact', name: '–ü–µ—Ä—á–∞—Ç–∫–∞ –ú–∞–≥–∞', bonus: '+15 –∫ –º–∞–≥–∏–∏', rarity: 'rare', value: 200},
        {type: 'artifact', name: '–ü–æ—è—Å –í–æ–∏–Ω–∞', bonus: '+10 –∫ –∞—Ç–∞–∫–µ –∏ –∑–∞—â–∏—Ç–µ', rarity: 'epic', value: 400},
        {type: 'artifact', name: '–û–∫–æ –î—Ä–∞–∫–æ–Ω–∞', bonus: '+25% –∫ –∑–æ–ª–æ—Ç—É', rarity: 'epic', value: 400},
        {type: 'artifact', name: '–°—Ñ–µ—Ä–∞ –ú–æ–≥—É—â–µ—Å—Ç–≤–∞', bonus: '+30% –∫ –æ–ø—ã—Ç—É', rarity: 'epic', value: 400},
        {type: 'artifact', name: '–ö–æ—Ä–æ–Ω–∞ –ö–æ—Ä–æ–ª—è', bonus: '+50% –∫ –∞—Ç–∞–∫–µ', rarity: 'legendary', value: 800},
        {type: 'artifact', name: '–ü–ª–∞—â –ë–µ—Å—Å–º–µ—Ä—Ç–∏—è', bonus: '+100 –∫ –∑–¥–æ—Ä–æ–≤—å—é', rarity: 'legendary', value: 800},
        {type: 'artifact', name: '–ñ–µ–∑–ª –í—Å–µ–≤–ª–∞—Å—Ç–∏—è', bonus: '+50 –∫ –º–∞–≥–∏–∏', rarity: 'legendary', value: 800}
    ],
    minigame: {
        active: false,
        success: false,
        damageMultiplier: 1,
        timer: null
    }
};

// –û–±—É—á–µ–Ω–∏–µ
let tutorialStep = 0;
const tutorialSteps = [
    "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–π –º–∏—Ä!",
    "–ò—Å–ø–æ–ª—å–∑—É–π [–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å] –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ä–∞–≥–æ–≤ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤",
    "–°—Ä–∞–∂–∞–π—Å—è —Å –≤—Ä–∞–≥–∞–º–∏ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∑–æ–ª–æ—Ç–æ, –∫–æ–¥—ã –∏ –æ–ø—ã—Ç",
    "–û—Ç–∫—Ä—ã–≤–∞–π [–ú–∞–≥–∞–∑–∏–Ω] –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π",
    "–ò—Å–ø–æ–ª—å–∑—É–π [–ö—Ä–∞—Ñ—Ç] –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è",
    "–û—Ç–¥—ã—Ö–∞–π [4] –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏ (–ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ 30 —Å–µ–∫)",
    "–í—ã–∑—ã–≤–∞–π [–ë–æ—Å—Å–æ–≤] –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–¥–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤",
    "–ò–∑—É—á–∞–π –º–∞–≥–∏—é –≤ –º–∞–≥–∞–∑–∏–Ω–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–π –µ—ë –≤ –±–æ—é",
    "–í –±–æ—é –∏–≥—Ä–∞–π –≤ –º–∏–Ω–∏-–∏–≥—Ä—É –¥–ª—è –Ω–∞–Ω–µ—Å–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–Ω–∞",
    "–ì–æ—Ç–æ–≤ –∫ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º! –£–¥–∞—á–∏, —Ö–∞–∫–µ—Ä!"
];

function nextTutorialStep() {
    if(tutorialStep < tutorialSteps.length) {
        document.getElementById('tutorialText').textContent = tutorialSteps[tutorialStep];
        tutorialStep++;
    } else {
        closeTutorial();
    }
}

function closeTutorial() {
    document.getElementById('tutorial').style.display = 'none';
    localStorage.setItem('tutorialCompleted', 'true');
}

// –ú–∏–Ω–∏-–∏–≥—Ä–∞
function startMinigame() {
    game.minigame.active = true;
    game.minigame.success = false;
    game.minigame.damageMultiplier = 1;
    document.getElementById('minigameContainer').style.display = 'block';
    document.getElementById('minigameResult').textContent = '';
    document.getElementById('minigameTimer').style.width = '100%';
    document.getElementById('minigameTarget').style.transform = 'scale(1)';
    document.getElementById('minigameTarget').style.boxShadow = 'none';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
    if(game.minigame.timer) {
        clearTimeout(game.minigame.timer);
    }
    
    // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞
    setTimeout(() => {
        document.getElementById('minigameTimer').style.width = '0%';
    }, 10);
    
    // –°–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ —É–¥–∞—Ä–∞ (–º–µ–∂–¥—É 0.3 –∏ 0.7 –æ—Ç –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)
    const successTime = 300 + Math.random() * 400;
    
    game.minigame.timer = setTimeout(() => {
        if (game.minigame.active) {
            game.minigame.success = true;
            document.getElementById('minigameTarget').style.transform = 'scale(1.2)';
            document.getElementById('minigameTarget').style.boxShadow = '0 0 20px #00ff9d';
        }
    }, successTime);
    
    // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∏–Ω–∏-–∏–≥—Ä—ã —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
    game.minigame.timer = setTimeout(() => {
        if (game.minigame.active) {
            endMinigame();
        }
    }, 1000);
}

function minigameClick() {
    if(!game.minigame.active) return;
    
    if(game.minigame.success) {
        game.minigame.damageMultiplier = 2;
        document.getElementById('minigameResult').textContent = '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä! x2 —É—Ä–æ–Ω–∞';
        document.getElementById('minigameResult').style.color = '#00ff9d';
    } else {
        game.minigame.damageMultiplier = 1;
        document.getElementById('minigameResult').textContent = '–û–±—ã—á–Ω—ã–π —É–¥–∞—Ä';
        document.getElementById('minigameResult').style.color = '#ffffff';
    }
    
    endMinigame();
}

function endMinigame() {
    game.minigame.active = false;
    if(game.minigame.timer) {
        clearTimeout(game.minigame.timer);
    }
    
    setTimeout(() => {
        document.getElementById('minigameContainer').style.display = 'none';
    }, 1000);
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Å—Å–∞–º–∏
function openBossPanel() {
    document.getElementById('bossPanel').style.display = 'block';
}

function closeBossPanel() {
    document.getElementById('bossPanel').style.display = 'none';
}

function startBossFight(difficulty) {
    let requiredCodes = 0;
    let bossStats = {};
    let rewards = {};
    
    switch(difficulty) {
        case 1: // –û–±—ã—á–Ω—ã–π
            requiredCodes = 500;
            bossStats = {
                name: '–û–±—ã—á–Ω—ã–π –ë–æ—Å—Å',
                hp: 150 + game.player.level * 15,
                atk: 30 + game.player.level * 3,
                color: '#00ff9d'
            };
            rewards = {
                gold: Math.floor(Math.random() * 151) + 150,
                codes: Math.floor(Math.random() * 6) + 5,
                xp: 50,
                rarity: 'rare'
            };
            break;
            
        case 2: // –°—Ä–µ–¥–Ω–∏–π
            requiredCodes = 1000;
            bossStats = {
                name: '–°—Ä–µ–¥–Ω–∏–π –ë–æ—Å—Å',
                hp: 250 + game.player.level * 20,
                atk: 45 + game.player.level * 4,
                color: '#00b8ff'
            };
            rewards = {
                gold: Math.floor(Math.random() * 201) + 300,
                codes: Math.floor(Math.random() * 6) + 10,
                xp: 100,
                rarity: 'epic'
            };
            break;
            
        case 3: // –ü–µ—Ä–≤–æ–∫–ª–∞—Å—Å–Ω—ã–π
            requiredCodes = 2500;
            bossStats = {
                name: '–ü–µ—Ä–≤–æ–∫–ª–∞—Å—Å–Ω—ã–π –£–±–∏–π—Ü–∞',
                hp: 400 + game.player.level * 25,
                atk: 60 + game.player.level * 5,
                color: '#ff5555'
            };
            rewards = {
                gold: Math.floor(Math.random() * 501) + 500,
                codes: Math.floor(Math.random() * 11) + 15,
                xp: 200,
                rarity: 'legendary'
            };
            break;
    }
    
    if(game.player.codes < requiredCodes) {
        addEvent(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–¥–æ–≤! –ù—É–∂–Ω–æ ${requiredCodes}üß©`, 'warning');
        return;
    }
    
    game.player.codes -= requiredCodes;
    closeBossPanel();
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–≥—Ä–∞–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –ø–æ–±–µ–¥—ã
    bossStats.rewards = rewards;
    
    // –ù–∞—á–∏–Ω–∞–µ–º –±–æ–π —Å –±–æ—Å—Å–æ–º
    startCombat(bossStats);
}

// –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
function updateUI() {
    document.getElementById('level').textContent = game.player.level;
    document.getElementById('hp').textContent = `${game.player.hp}/${game.player.maxHp}`;
    
    // –£—á–∏—Ç—ã–≤–∞–µ–º –±–æ–Ω—É—Å –º–∞–≥–∏–∏ –∫ –∞—Ç–∞–∫–µ
    const totalAtk = game.player.atk + (game.player.equipment.weapon?.atk || 0) + (game.player.magic.active ? game.player.magic.bonusAtk : 0);
    document.getElementById('atk').textContent = totalAtk;
    
    document.getElementById('def').textContent = game.player.def + (game.player.equipment.armor?.def || 0);
    document.getElementById('gold').textContent = game.player.gold;
    document.getElementById('codes').textContent = game.player.codes;
    document.getElementById('energy').textContent = game.player.energy;
    document.getElementById('magicLevel').textContent = game.player.magic.level;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ—Å–∫–∏
    document.getElementById('healthBar').style.width = `${(game.player.hp / game.player.maxHp) * 100}%`;
    document.getElementById('energyBar').style.width = `${game.player.energy}%`;
    document.getElementById('xpBar').style.width = `${(game.player.xp / game.player.xpToNextLevel) * 100}%`;
    document.getElementById('magicProgress').style.width = `${game.player.magic.progress}%`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –º–∞–≥–∏–∏
    const magicButton = document.getElementById('magicButton');
    if(game.player.magic.learned) {
        magicButton.disabled = game.player.energy < 30 || game.player.magic.level === 0;
        magicButton.textContent = `[6] –ú–∞–≥–∏—è (–£—Ä.${game.player.magic.level})`;
    } else {
        magicButton.disabled = true;
        magicButton.textContent = '[6] –ú–∞–≥–∏—è (–ù–µ –∏–∑—É—á–µ–Ω–∞)';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–¥—ã—Ö–∞
    const restButton = document.getElementById('restButton');
    const restCooldownFill = document.getElementById('restCooldownFill');
    const now = Date.now();
    const cooldownLeft = Math.max(0, 30000 - (now - game.player.lastRestTime));
    
    if(cooldownLeft > 0) {
        restButton.disabled = true;
        restCooldownFill.style.width = `${(cooldownLeft / 30000) * 100}%`;
    } else {
        restButton.disabled = false;
        restCooldownFill.style.width = '0%';
    }
    
    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –Ω–∏–∑–∫—É—é —ç–Ω–µ—Ä–≥–∏—é
    if(game.player.energy < 20) {
        document.getElementById('energy').classList.add('energy-low');
    } else {
        document.getElementById('energy').classList.remove('energy-low');
    }
    
    renderInventory();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –º–∞–≥–∏–∏
    if(game.player.magic.active && Date.now() >= game.player.magic.endTime) {
        endMagicEffect();
    }
}

function changeLocation(locationIndex) {
    game.player.currentLocation = locationIndex;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ª–æ–∫–∞—Ü–∏–π
    document.querySelectorAll('.location-btn').forEach((btn, index) => {
        if(index === locationIndex) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    addEvent(`–í—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏—Å—å –≤ –ª–æ–∫–∞—Ü–∏—é: ${game.locations[locationIndex].name}`, 'info');
}

function explore() {
    const location = game.locations[game.player.currentLocation];
    
    if(game.player.energy < location.energyCost) {
        addEvent('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'warning');
        return;
    }
    
    game.player.energy -= location.energyCost;
    
    if(Math.random() < 0.7) {
        startCombat();
    } else {
        const goldFound = Math.floor(Math.random() * (20 + game.player.currentLocation * 20)) + 5;
        const codesFound = Math.random() > 0.7 ? (2 + game.player.currentLocation) : (1 + Math.floor(game.player.currentLocation / 2));
        const xpFound = Math.floor(Math.random() * (10 + game.player.currentLocation * 10)) + 5;
        
        game.player.gold += goldFound;
        game.player.codes += codesFound;
        game.player.xp += xpFound;
        
        addEvent(`–ù–∞–π–¥–µ–Ω—ã —Ä–µ—Å—É—Ä—Å—ã: +${goldFound}üí∞ +${codesFound}üß© +${xpFound}XP`, 'success');
        checkLevelUp();
    }
    updateUI();
    nextTutorialStep();
}

function startCombat(enemy) {
    if(!enemy) {
        let enemyPool;
        switch(game.player.currentLocation) {
            case 0: enemyPool = game.enemies.easy; break;
            case 1: enemyPool = game.enemies.medium; break;
            case 2: enemyPool = game.enemies.hard; break;
            case 3: enemyPool = game.enemies.hell; break;
            default: enemyPool = game.enemies.easy;
        }
        
        const enemyLevel = Math.min(game.player.level, enemyPool.length);
        enemy = {...enemyPool[Math.floor(Math.random() * enemyLevel)]};
    }
    
    addEvent(`–û–±–Ω–∞—Ä—É–∂–µ–Ω –≤—Ä–∞–≥: <span style="color:${enemy.color}">${enemy.name}</span>`, 'combat');
    
    const combatInterval = setInterval(() => {
        // –ó–∞–ø—É—Å–∫–∞–µ–º –º–∏–Ω–∏-–∏–≥—Ä—É –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —É–¥–∞—Ä–æ–º
        startMinigame();
        
        // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∏–Ω–∏-–∏–≥—Ä—ã
        const checkMinigame = setInterval(() => {
            if(!game.minigame.active) {
                clearInterval(checkMinigame);
                
                const playerAtk = game.player.atk + (game.player.equipment.weapon?.atk || 0) + (game.player.magic.active ? game.player.magic.bonusAtk : 0);
                const playerDef = game.player.def + (game.player.equipment.armor?.def || 0);
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å —É—Ä–æ–Ω–∞ –∏–∑ –º–∏–Ω–∏-–∏–≥—Ä—ã
                const playerDamage = Math.max(1, (playerAtk - Math.floor(enemy.atk * 0.3)) * game.minigame.damageMultiplier);
                const enemyDamage = Math.max(1, enemy.atk - Math.floor(playerDef * 0.5));
                
                enemy.hp -= playerDamage;
                game.player.hp -= enemyDamage;
                
                addEvent(`–í—ã –∞—Ç–∞–∫—É–µ—Ç–µ: -${playerDamage}‚öîÔ∏è (<span style="color:${enemy.color}">${enemy.hp}‚ù§Ô∏è</span>)`, 'combat');
                addEvent(`<span style="color:${enemy.color}">${enemy.name}</span> –∞—Ç–∞–∫—É–µ—Ç: -${enemyDamage}üí¢`, 'combat');
                
                if(game.player.hp <= 0) {
                    const goldLost = Math.floor(game.player.gold * 0.2);
                    game.player.gold = Math.max(0, game.player.gold - goldLost);
                    game.player.hp = Math.floor(game.player.maxHp * 0.3);
                    addEvent(`–ü–û–†–ê–ñ–ï–ù–ò–ï! –ü–æ—Ç–µ—Ä—è–Ω–æ ${goldLost}üí∞`, 'danger');
                    clearInterval(combatInterval);
                }
                
                if(enemy.hp <= 0) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —ç—Ç–æ –±–æ—Å—Å
                    if(enemy.rewards) {
                        game.player.gold += enemy.rewards.gold;
                        game.player.codes += enemy.rewards.codes;
                        game.player.xp += enemy.rewards.xp;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–¥–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç –∑–∞ –ø–æ–±–µ–¥—É –Ω–∞–¥ –±–æ—Å—Å–æ–º
                        const bossItems = game.bossItems[enemy.rewards.rarity];
                        const randomBossItem = bossItems[Math.floor(Math.random() * bossItems.length)];
                        game.player.inventory.push(randomBossItem);
                        
                        let rarityColor;
                        switch(enemy.rewards.rarity) {
                            case 'rare': rarityColor = '#00b8ff'; break;
                            case 'epic': rarityColor = '#aa00ff'; break;
                            case 'legendary': rarityColor = '#ffaa00'; break;
                        }
                        
                        addEvent(`–ü–æ–±–µ–¥–∞ –Ω–∞–¥ –±–æ—Å—Å–æ–º! +${enemy.rewards.gold}üí∞ +${enemy.rewards.codes}üß© +${enemy.rewards.xp}XP`, 'success');
                        addEvent(`–ü–æ–ª—É—á–µ–Ω <span style="color:${rarityColor}">${randomBossItem.name}</span>`, 'success');
                    } else {
                        game.player.gold += enemy.gold;
                        game.player.codes += 2 + game.player.currentLocation;
                        game.player.xp += enemy.xp;
                        addEvent(`–ü–æ–±–µ–¥–∞! +${enemy.gold}üí∞ +${2 + game.player.currentLocation}üß© +${enemy.xp}XP`, 'success');
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–ø–∞–ª –ª–∏ –ø—Ä–µ–¥–º–µ—Ç (–¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –∏ —Å–ª–æ–∂–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π)
                        if(game.player.currentLocation >= 2 && Math.random() < (enemy.dropChance || 0.5)) {
                            const randomItem = game.lootItems[Math.floor(Math.random() * game.lootItems.length)];
                            game.player.inventory.push(randomItem);
                            
                            let rarityColor;
                            switch(randomItem.rarity) {
                                case 'rare': rarityColor = '#00b8ff'; break;
                                case 'epic': rarityColor = '#aa00ff'; break;
                                case 'legendary': rarityColor = '#ffaa00'; break;
                                default: rarityColor = '#00ff9d';
                            }
                            
                            addEvent(`–ü–æ–ª—É—á–µ–Ω –ø—Ä–µ–¥–º–µ—Ç: <span style="color:${rarityColor}">${randomItem.name}</span>`, 'success');
                        }
                    }
                    
                    checkLevelUp();
                    clearInterval(combatInterval);
                }
                
                updateUI();
            }
        }, 100);
    }, 1500);
}

function useMagic() {
    if(!game.player.magic.learned || game.player.magic.level === 0) {
        addEvent('–ú–∞–≥–∏—è –Ω–µ –∏–∑—É—á–µ–Ω–∞ –∏–ª–∏ —É—Ä–æ–≤–µ–Ω—å —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π!', 'warning');
        return;
    }
    
    if(game.player.energy < 30) {
        addEvent('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞–≥–∏–∏!', 'warning');
        return;
    }
    
    game.player.energy -= 30;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ–Ω—É—Å –º–∞–≥–∏–∏ (10% –æ—Ç –±–∞–∑–æ–≤–æ–π –∞—Ç–∞–∫–∏ –∑–∞ —É—Ä–æ–≤–µ–Ω—å)
    game.player.magic.bonusAtk = Math.floor(game.player.atk * 0.1 * game.player.magic.level);
    game.player.magic.active = true;
    game.player.magic.endTime = Date.now() + 120000; // 2 –º–∏–Ω—É—Ç—ã
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è (20% –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ)
    const healAmount = Math.floor(game.player.maxHp * 0.2);
    game.player.hp = Math.min(game.player.maxHp, game.player.hp + healAmount);
    
    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –º–∞–≥–∏–∏
    document.getElementById('magicEffect').style.opacity = '1';
    setTimeout(() => {
        document.getElementById('magicEffect').style.opacity = '0';
    }, 1000);
    
    addEvent(`–ú–∞–≥–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! +${game.player.magic.bonusAtk} –∫ –∞—Ç–∞–∫–µ –Ω–∞ 2 –º–∏–Ω—É—Ç—ã –∏ +${healAmount}‚ù§Ô∏è`, 'magic');
    
    updateUI();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –º–∞–≥–∏–∏
    setTimeout(() => {
        if(game.player.magic.active && Date.now() >= game.player.magic.endTime) {
            endMagicEffect();
        }
    }, 120000);
}

function endMagicEffect() {
    if(game.player.magic.active) {
        game.player.magic.active = false;
        game.player.magic.bonusAtk = 0;
        addEvent('–≠—Ñ—Ñ–µ–∫—Ç –º–∞–≥–∏–∏ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è', 'info');
        updateUI();
    }
}

function craft() {
    if(game.player.codes < 2) {
        addEvent('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∫–æ–¥–∞ –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞!', 'warning');
        return;
    }
    
    const code1 = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∫–æ–¥ (4 —Ü–∏—Ñ—Ä—ã 0/1):');
    const code2 = prompt('–í–≤–µ–¥–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –∫–æ–¥ (4 —Ü–∏—Ñ—Ä—ã 0/1):');
    
    if(code1 && code2 && code1.length === 4 && code2.length === 4 && 
       /^[01]+$/.test(code1) && /^[01]+$/.test(code2)) {
        game.player.codes -= 2;
        const recipeKey = `${code1}+${code2}`;
        if(game.craftingRecipes[recipeKey]) {
            const item = game.craftingRecipes[recipeKey];
            game.player.inventory.push(item);
            
            let rarityColor;
            switch(item.rarity) {
                case 'rare': rarityColor = '#00b8ff'; break;
                case 'epic': rarityColor = '#aa00ff'; break;
                case 'legendary': rarityColor = '#ffaa00'; break;
                default: rarityColor = '#00ff9d';
            }
            
            addEvent(`–°–æ–∑–¥–∞–Ω <span style="color:${rarityColor}">${item.name}</span>!`, 'success');
        } else {
            // –°–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –∫—Ä–∞—Ñ—Ç–µ
            const randomItems = [
                {type: 'weapon', name: '–°–ª–æ–º–∞–Ω–Ω—ã–π –º–µ—á', atk: 5, rarity: 'common', value: 30},
                {type: 'armor', name: '–î—ã—Ä—è–≤—ã–π —â–∏—Ç', def: 3, rarity: 'common', value: 30},
                {type: 'artifact', name: '–û—Å–∫–æ–ª–æ–∫ –∫–æ–¥–∞', bonus: '+1 –∫–æ –≤—Å–µ–º—É', rarity: 'common', value: 30}
            ];
            const randomItem = randomItems[Math.floor(Math.random() * randomItems.length)];
            game.player.inventory.push(randomItem);
            addEvent('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è! –ü–æ–ª—É—á–µ–Ω —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç.', 'info');
        }
    } else {
        addEvent('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ 0 –∏ 1 (4 —Å–∏–º–≤–æ–ª–∞)!', 'warning');
    }
    updateUI();
}

function openShop() {
    document.getElementById('shopPanel').style.display = 'block';
    document.getElementById('shopItems').innerHTML = game.shopItems.map(item => `
        <div class="shop-item">
            <div class="shop-item-name">${item.icon} ${item.name}</div>
            <div class="shop-item-price">${item.costGold}üí∞ ${item.costCodes ? `+ ${item.costCodes}üß©` : ''}</div>
            <button onclick="buyItem(${game.shopItems.indexOf(item)})" 
                ${game.player.gold < item.costGold || game.player.codes < item.costCodes ? 'disabled' : ''}>
                –ö—É–ø–∏—Ç—å
            </button>
        </div>
    `).join('');
}

function buyItem(index) {
    const item = game.shopItems[index];
    if(!item) return;
    
    if(game.player.gold >= item.costGold && game.player.codes >= item.costCodes) {
        game.player.gold -= item.costGold;
        game.player.codes -= item.costCodes;
        
        switch(item.type) {
            case 'heal': 
                game.player.hp = Math.min(game.player.maxHp, game.player.hp + 50);
                addEvent(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${item.name}`, 'heal');
                break;
            case 'code':
                game.player.codes += 5;
                addEvent(`–ü–æ–ª—É—á–µ–Ω–æ 5 –∫–æ–¥–æ–≤`, 'success');
                break;
            case 'atk':
                game.player.atk += 5;
                addEvent(`–ê—Ç–∞–∫–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ 5`, 'upgrade');
                break;
            case 'def':
                game.player.def += 5;
                addEvent(`–ó–∞—â–∏—Ç–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ 5`, 'upgrade');
                break;
            case 'energy':
                game.player.energy += 50;
                addEvent(`–≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞`, 'energy');
                break;
            case 'fullheal':
                game.player.hp = game.player.maxHp;
                addEvent(`–ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è`, 'heal');
                break;
            case 'learnMagic':
                if(!game.player.magic.learned) {
                    game.player.magic.learned = true;
                    game.player.magic.level = 1;
                    game.player.magic.progress = 0;
                    game.player.magic.learning = true;
                    game.player.magic.learnEndTime = Date.now() + 300000; // 5 –º–∏–Ω—É—Ç
                    addEvent(`–ù–∞—á–∞—Ç–æ –∏–∑—É—á–µ–Ω–∏–µ –º–∞–≥–∏–∏! –ó–∞–≤–µ—Ä—à–∏—Ç—Å—è —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç.`, 'magic');
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –æ–±—É—á–µ–Ω–∏—è –º–∞–≥–∏–∏
                    const magicLearningInterval = setInterval(() => {
                        if(Date.now() >= game.player.magic.learnEndTime) {
                            game.player.magic.learning = false;
                            game.player.magic.progress = 100;
                            addEvent(`–ú–∞–≥–∏—è –∏–∑—É—á–µ–Ω–∞! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏.`, 'magic');
                            updateUI();
                            clearInterval(magicLearningInterval);
                        } else {
                            const timeLeft = game.player.magic.learnEndTime - Date.now();
                            game.player.magic.progress = 100 - (timeLeft / 300000 * 100);
                            updateUI();
                        }
                    }, 1000);
                }
                break;
            case 'upgradeMagic':
                if(game.player.magic.learned) {
                    game.player.magic.level++;
                    addEvent(`–£—Ä–æ–≤–µ–Ω—å –º–∞–≥–∏–∏ –ø–æ–≤—ã—à–µ–Ω –¥–æ ${game.player.magic.level}`, 'magic');
                } else {
                    addEvent(`–°–Ω–∞—á–∞–ª–∞ –∏–∑—É—á–∏—Ç–µ –º–∞–≥–∏—é!`, 'warning');
                }
                break;
            case 'weapon':
            case 'armor':
            case 'artifact':
                game.player.inventory.push(item);
                addEvent(`–ö—É–ø–ª–µ–Ω ${item.name}`, 'success');
                break;
        }
        updateUI();
    } else {
        addEvent('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!', 'warning');
    }
}

function rest() {
    const now = Date.now();
    const cooldownLeft = Math.max(0, 30000 - (now - game.player.lastRestTime));
    
    if(cooldownLeft > 0) {
        addEvent(`–û—Ç–¥—ã—Ö –Ω–∞ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–µ! –û—Å—Ç–∞–ª–æ—Å—å ${Math.ceil(cooldownLeft/1000)} —Å–µ–∫.`, 'warning');
        return;
    }
    
    game.player.energy = Math.min(100, game.player.energy + 50);
    game.player.lastRestTime = now;
    addEvent('–í—ã –æ—Ç–¥–æ—Ö–Ω—É–ª–∏ (+50üîã). –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞: 30 —Å–µ–∫.', 'energy');
    updateUI();
}

function checkLevelUp() {
    if(game.player.xp >= game.player.xpToNextLevel) {
        game.player.level++;
        game.player.xp -= game.player.xpToNextLevel;
        game.player.xpToNextLevel = Math.floor(game.player.xpToNextLevel * 1.5);
        game.player.maxHp += 20;
        game.player.atk += 3;
        game.player.def += 2;
        game.player.hp = game.player.maxHp;
        game.player.energy = 100;
        addEvent(`–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! [${game.player.level}]`, 'levelup');
        
        // –ù–æ–≤—ã–µ –≤—Ä–∞–≥–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–∞ –≤—ã—Å–æ–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö
        if(game.player.level % 3 === 0) {
            const newEnemy = {
                name: `–ë–æ—Å—Å Lv.${game.player.level}`,
                hp: 150 + game.player.level * 10,
                atk: 30 + game.player.level * 2,
                gold: 100 + game.player.level * 10,
                xp: 100,
                color: '#ff00aa'
            };
            game.enemies.easy.push(newEnemy);
            addEvent(`–ü–æ—è–≤–∏–ª—Å—è –Ω–æ–≤—ã–π –≤—Ä–∞–≥: <span style="color:#ff00aa">${newEnemy.name}</span>`, 'danger');
        }
    }
}

function renderInventory() {
    const inv = document.getElementById('inventory');
    inv.innerHTML = game.player.inventory.map((item, index) => {
        let rarityClass = '';
        let rarityColor = '';
        
        if(item.rarity) {
            switch(item.rarity) {
                case 'rare':
                    rarityClass = 'rare-item';
                    rarityColor = '#00b8ff';
                    break;
                case 'epic':
                    rarityClass = 'epic-item';
                    rarityColor = '#aa00ff';
                    break;
                case 'legendary':
                    rarityClass = 'legendary-item';
                    rarityColor = '#ffaa00';
                    break;
            }
        }
        
        return `
        <div class="item ${rarityClass}" style="border-color: ${rarityColor || 'rgba(0, 255, 157, 0.1)'}">
            <div class="item-name" style="color: ${rarityColor || '#00ff9d'}">${item.name}</div>
            <div class="item-stats">
                ${item.atk ? `‚öîÔ∏è –ê—Ç–∞–∫–∞: +${item.atk}<br>` : ''}
                ${item.def ? `üõ°Ô∏è –ó–∞—â–∏—Ç–∞: +${item.def}<br>` : ''}
                ${item.bonus ? `‚ú® ${item.bonus}<br>` : ''}
                ${item.value ? `üí∞ –¶–µ–Ω–∞: ${item.value}` : ''}
            </div>
            <button onclick="equip(${index})">–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="sell-btn" onclick="sellItem(${index})">–ü—Ä–æ–¥–∞—Ç—å</button>
        </div>
        `;
    }).join('');
}

function equip(index) {
    const item = game.player.inventory[index];
    if(!item) return;
    
    if(item.type === 'weapon' || item.type === 'armor' || item.type === 'artifact') {
        game.player.equipment[item.type] = item;
        
        let rarityColor;
        switch(item.rarity) {
            case 'rare': rarityColor = '#00b8ff'; break;
            case 'epic': rarityColor = '#aa00ff'; break;
            case 'legendary': rarityColor = '#ffaa00'; break;
            default: rarityColor = '#00ff9d';
        }
        
        addEvent(`–≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω <span style="color:${rarityColor}">${item.name}</span>`, 'success');
    }
    updateUI();
}

function sellItem(index) {
    const item = game.player.inventory[index];
    if(!item || !item.value) return;
    
    const sellPrice = Math.floor(item.value * 0.7); // 70% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    game.player.gold += sellPrice;
    game.player.inventory.splice(index, 1);
    
    addEvent(`–ü—Ä–æ–¥–∞–Ω ${item.name} –∑–∞ ${sellPrice}üí∞`, 'success');
    updateUI();
}

function addEvent(msg, type) {
    const eventsDiv = document.getElementById('events');
    const combatLog = document.getElementById('combatLog');
    
    const event = document.createElement('div');
    event.innerHTML = `[${new Date().toLocaleTimeString().slice(0,5)}] ${msg}`;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è
    if(type === 'combat') {
        combatLog.appendChild(event);
        if(combatLog.children.length > 5) combatLog.removeChild(combatLog.children[0]);
    } else {
        event.classList.add(type || 'info');
        eventsDiv.prepend(event);
        if(eventsDiv.children.length > 8) eventsDiv.removeChild(eventsDiv.lastChild);
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
function saveGame() {
    localStorage.setItem('neonDigitalRPG', JSON.stringify(game));
    addEvent('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞', 'success');
}

function loadGame() {
    const savedGame = localStorage.getItem('neonDigitalRPG');
    if(savedGame) {
        Object.assign(game, JSON.parse(savedGame));
        addEvent('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
        updateUI();
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
window.onload = function() {
    if(!localStorage.getItem('tutorialCompleted')) {
        document.getElementById('tutorial').style.display = 'block';
    } else {
        document.getElementById('tutorial').style.display = 'none';
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadGame();
    
    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(saveGame, 30000);
    
    // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—É—á–µ–Ω–∏—è –º–∞–≥–∏–∏
    setInterval(() => {
        if(game.player.magic.learning && Date.now() >= game.player.magic.learnEndTime) {
            game.player.magic.learning = false;
            game.player.magic.progress = 100;
            addEvent(`–ú–∞–≥–∏—è –∏–∑—É—á–µ–Ω–∞! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏.`, 'magic');
            updateUI();
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –º–∞–≥–∏–∏
        if(game.player.magic.active && Date.now() >= game.player.magic.endTime) {
            endMagicEffect();
        }
    }, 1000);
    
    updateUI();
}

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
window.addEventListener('beforeunload', saveGame);
</script>
</body>
  </html>
